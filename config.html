<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.23">
<title>Kanata Configuration Guide</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.square{list-style-type:square}
ul.circle ul:not([class]),ul.disc ul:not([class]),ul.square ul:not([class]){list-style:inherit}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child{border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:first-child,.sidebarblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child,.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active,#footnotes .footnote a:first-of-type:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,td.hdlist1,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>Kanata Configuration Guide</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_how_to_read_the_guide">How to read the guide</a></li>
<li><a href="#_preamble">Preamble</a></li>
<li><a href="#force-exit">Forcefully exit kanata</a></li>
<li><a href="#comments">Comments</a></li>
<li><a href="#required-configuration-entries">Required configuration entries</a>
<ul class="sectlevel2">
<li><a href="#defsrc">defsrc</a></li>
<li><a href="#deflayer">deflayer</a></li>
<li><a href="#review-of-required-configuration-entries">Review of required configuration entries</a></li>
</ul>
</li>
<li><a href="#key-names">Key names for defsrc and deflayermap</a></li>
<li><a href="#non-us-keyboards">Non-US keyboards</a>
<ul class="sectlevel2">
<li><a href="#_browser_event_code">Browser event.code</a></li>
<li><a href="#deflocalkeys">deflocalkeys</a></li>
</ul>
</li>
<li><a href="#introduction-defcfg">Introduction to defcfg</a>
<ul class="sectlevel2">
<li><a href="#process-unmapped-keys">process-unmapped-keys</a></li>
</ul>
</li>
<li><a href="#_aliases_and_variables">Aliases and variables</a>
<ul class="sectlevel2">
<li><a href="#aliases">Aliases</a></li>
<li><a href="#variables">Variables</a></li>
</ul>
</li>
<li><a href="#actions">Actions</a>
<ul class="sectlevel2">
<li><a href="#live-reload">Live reload</a></li>
<li><a href="#layer-switch">layer-switch</a></li>
<li><a href="#layer-while-held">layer-while-held</a></li>
<li><a href="#transparent-key">Transparent key</a></li>
<li><a href="#use-defsrc">use-defsrc</a></li>
<li><a href="#no-op">No-op</a></li>
<li><a href="#unicode">Unicode</a></li>
<li><a href="#output-chordscombos">Output chords/combos</a></li>
<li><a href="#repeat-key">Repeat key</a></li>
<li><a href="#release-a-key-or-layer">Release a key or layer</a></li>
<li><a href="#multi">multi</a></li>
<li><a href="#mouse-actions">Mouse actions</a></li>
<li><a href="#tap-dance">tap-dance</a></li>
<li><a href="#one-shot">one-shot</a></li>
<li><a href="#tap-hold">tap-hold</a></li>
<li><a href="#macro">macro</a></li>
<li><a href="#dynamic-macro">dynamic-macro</a></li>
<li><a href="#caps-word">caps-word</a></li>
<li><a href="#_unmod">unmod</a></li>
<li><a href="#fork">fork</a></li>
<li><a href="#switch">switch</a></li>
<li><a href="#cmd">cmd</a></li>
<li><a href="#arbitrary-code">arbitrary-code</a></li>
</ul>
</li>
<li><a href="#global-overrides">Global overrides</a></li>
<li><a href="#_include_other_files">Include other files</a></li>
<li><a href="#platform">Platform-specific configuration</a></li>
<li><a href="#environment">Environment-conditional configuration</a></li>
<li><a href="#input-chords-v2">Input chords / combos (v2)</a></li>
<li><a href="#optional-defcfg-options">defcfg options</a>
<ul class="sectlevel2">
<li><a href="#danger-enable-cmd">danger-enable-cmd</a></li>
<li><a href="#sequence-timeout">sequence-timeout</a></li>
<li><a href="#sequence-input-mode">sequence-input-mode</a></li>
<li><a href="#sequence-backtrack-modcancel">sequence-backtrack-modcancel</a></li>
<li><a href="#log-layer-changes">log-layer-changes</a></li>
<li><a href="#delegate-to-first-layer">delegate-to-first-layer</a></li>
<li><a href="#movemouse-inherit-accel-state">movemouse-inherit-accel-state</a></li>
<li><a href="#movemouse-smooth-diagonals">movemouse-smooth-diagonals</a></li>
<li><a href="#dynamic-macro-max-presses">dynamic-macro-max-presses</a></li>
<li><a href="#concurrent-tap-hold">concurrent-tap-hold</a></li>
<li><a href="#block-unmapped-keys">block-unmapped-keys</a></li>
<li><a href="#rapid-event-delay">rapid-event-delay</a></li>
<li><a href="#chords-v2-min-idle">chords-v2-min-idle</a></li>
<li><a href="#override-release-on-activation">override-release-on-activation</a></li>
<li><a href="#allow-hardware-repeat">allow-hardware-repeat</a></li>
<li><a href="#alias-to-trigger-on-load">alias-to-trigger-on-load</a></li>
<li><a href="#linux-only-linux-dev">Linux only: linux-dev</a></li>
<li><a href="#linux-only-linux-dev-names-include">Linux only: linux-dev-names-include</a></li>
<li><a href="#linux-only-linux-dev-names-exclude">Linux only: linux-dev-names-exclude</a></li>
<li><a href="#linux-only-linux-continue-if-no-devs-found">Linux only: linux-continue-if-no-devs-found</a></li>
<li><a href="#linux-only-linux-device-detect-mode">Linux only: linux-device-detect-mode</a></li>
<li><a href="#linux-only-linux-unicode-u-code">Linux only: linux-unicode-u-code</a></li>
<li><a href="#linux-only-linux-unicode-termination">Linux only: linux-unicode-termination</a></li>
<li><a href="#_linux_only_linux_x11_repeat_delay_rate">Linux only: linux-x11-repeat-delay-rate</a></li>
<li><a href="#linux-only-linux-use-trackpoint-property">Linux only: linux-use-trackpoint-property</a></li>
<li><a href="#linux-only-linux-output-device-bus-type">Linux only: linux-output-device-bus-type</a></li>
<li><a href="#macos-only-macos-dev-names-include">macOS only: macos-dev-names-include</a></li>
<li><a href="#windows-only-windows-altgr">Windows only: windows-altgr</a></li>
<li><a href="#_windows_only_windows_interception_mouse_hwid">Windows only: windows-interception-mouse-hwid</a></li>
<li><a href="#_windows_only_windows_interception_mouse_hwids">Windows only: windows-interception-mouse-hwids</a></li>
<li><a href="#_windows_only_windows_interception_keyboard_hwids">Windows only: windows-interception-keyboard-hwids</a></li>
<li><a href="#windows-only-tray-icon">Windows only: tray-icon</a></li>
<li><a href="#windows-only-icon-match-layer-name">Windows only: icon-match-layer-name</a></li>
<li><a href="#windows-only-tooltip-layer-changes">Windows only: tooltip-layer-changes</a></li>
<li><a href="#windows-only-tooltip-show-blank">Windows only: tooltip-show-blank</a></li>
<li><a href="#windows-only-tooltip-no-base">Windows only: tooltip-no-base</a></li>
<li><a href="#windows-only-tooltip-duration">Windows only: tooltip-duration</a></li>
<li><a href="#windows-only-tooltip-size">Windows only: tooltip-size</a></li>
<li><a href="#windows-only-notify-cfg-reload">Windows only: notify-cfg-reload</a></li>
<li><a href="#windows-only-notify-cfg-reload-silent">Windows only: notify-cfg-reload-silent</a></li>
<li><a href="#windows-only-notify-error">Windows only: notify-error</a></li>
<li><a href="#using-multiple-defcfg-options">Using multiple defcfg options</a></li>
</ul>
</li>
<li><a href="#_advanced_features">Advanced features</a>
<ul class="sectlevel2">
<li><a href="#virtual-keys">Virtual keys</a></li>
<li><a href="#sequences">Sequences</a></li>
<li><a href="#input-chords">Input chords</a></li>
<li><a href="#defaliasenvcond">defaliasenvcond</a></li>
<li><a href="#templates">Templates</a></li>
<li><a href="#custom-tap-hold-behaviour">Custom tap-hold behaviour</a></li>
<li><a href="#fancy-key-symbols">Fancy key symbols</a></li>
<li><a href="#windows-only-work-elevated">Windows only: enable in elevated windows</a></li>
<li><a href="#windows-only-win-tray">Windows only: win-tray</a></li>
<li><a href="#test-your-config">Test your config</a></li>
<li><a href="#zippychord">Zippychord</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This document describes how to create a kanata configuration file.
The kanata configuration file will determine your keyboard behaviour upon running kanata.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_read_the_guide">How to read the guide</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <strong>Reference</strong> sections are shorter
and are intended for reviewing how precisely to configure different sections.
The <strong>Description</strong> sections are longer
and contain more details such as advice, motivation, and examples.</p>
</div>
<div class="paragraph">
<p>The configuration guide you are reading
may have content not applicable to the version you are using.
See below for links to specific guide versions.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="/config-1.7.0.html">v1.7.0</a></p>
</li>
<li>
<p><a href="/config-1.6.1.html">v1.6.1</a></p>
</li>
<li>
<p><a href="/config-1.6.0.html">v1.6.0</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_preamble">Preamble</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The configuration file uses S-expression syntax from Lisps. If you are not
familiar with any Lisp-like programming language, do not be too worried. This
document will hopefully be a sufficient guide to help you customize your
keyboard behaviour to your exact liking.</p>
</div>
<div class="paragraph">
<p>Useful terminology to learn early:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A sequence of characters.
Optionally surrounded by quotes.
Examples: <code>backspace</code>, <code>"string with spaces and 1 number"</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">list</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A sequence of strings or nested lists within round brackets.
List items are separated by any amount of whitespace characters,
or by round brackets.
Examples: <code>(lrld-num 1)</code>, <code>(tap-dance 200 (f1(unicode ðŸ˜€)f2(unicode ðŸ™‚)))</code>.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>If you have any questions, confusions, suggestions, etc., feel free to
<a href="https://github.com/jtroo/kanata/discussions/new/choose">start a discussion</a>
or <a href="https://github.com/jtroo/kanata/issues/new/choose">file an issue</a>.
If you have ideas for how to improve this document or any other part of the project,
please be welcome to make a pull request or file an issue.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="force-exit">Forcefully exit kanata</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Though this isn&#8217;t configuration-related,
it may be important for you to know that pressing and holding all of the
three following keys together at the same time will cause kanata to exit:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Left Control</p>
</li>
<li>
<p>Space</p>
</li>
<li>
<p>Escape</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This mechanism works on the key input <strong>before</strong> any remappings done by kanata.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="comments">Comments</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can add comments to your configuration file. Comments are prefixed with two
semicolons. E.g:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>;; This is a comment in a kanata configuration file.
;; Comments will be ignored and are intended for you to help understand your
;; own configuration when reading it later.</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can begin a multi-line comment block with <code>#|</code> and end it with <code>|#</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>#|
This is
a multi-line comment block
|#</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="required-configuration-entries">Required configuration entries</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="defsrc">defsrc</h3>
<div class="paragraph">
<p><strong>Reference</strong></p>
</div>
<div class="paragraph">
<p>Your configuration file must have exactly one <code>defsrc</code> list.
This defines the order of keys that the <code>deflayer</code> entries will operate on.</p>
</div>
<div class="listingblock">
<div class="title">Syntax:</div>
<div class="content">
<pre class="highlight"><code>(defsrc $key1 $key2 ... $keyN)</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 85.7143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$key</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of a key. This can be a default key name or one defined in <a href="#deflocalkeys">deflocalkeys</a>.
When physically pressing this input key, the action defined
at the same order position on the active layer will activate.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Description</strong></p>
</div>
<div class="paragraph">
<p>The <code>defsrc</code> configuration entry defines which of your key inputs
will be processed by kanata and how the keys map to defined layers.
Keys excluded from <code>defsrc</code> will not be processed by Kanata
unless you have <code>process-unmapped-keys yes</code> in <a href="#introduction-defcfg">defcfg</a>.</p>
</div>
<div class="paragraph">
<p>Keys not processed by Kanata has implications on various actions.
For example:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Pressing an excluded key will type a letter
while a prior <code>tap-hold</code> decision is still pending,
resulting in potentially incorrect results.</p>
</li>
<li>
<p>Excluded keys do not trigger early activation
in actions such as <code>tap-hold-press</code> or <code>tap-dance</code></p>
</li>
<li>
<p>Excluded keys cannot be read by <code>fork</code> or <code>switch</code> logic.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>defsrc</code> entry is treated as a long sequence.
The amount of whitespace (spaces, tabs, newlines) are not relevant.
You may use spaces, tabs, or newlines however you like
to visually format <code>defsrc</code> to your liking.</p>
</div>
<div class="paragraph">
<p>The primary source of all key names are the
<code>str_to_oscode</code> and <code>default_mappings</code> functions in
<a href="https://github.com/jtroo/kanata/blob/main/parser/src/keys/mod.rs">the source</a>.
Please feel welcome to file an issue
if you&#8217;re unable to find the key you&#8217;re looking for.</p>
</div>
<div class="paragraph">
<p>An example <code>defsrc</code> containing the US QWERTY keyboard keys as an
approximately 60% keyboard layout:</p>
</div>
<div class="listingblock">
<div class="title">Example:</div>
<div class="content">
<pre class="highlight"><code>(defsrc
  grv  1    2    3    4    5    6    7    8    9    0    -    =    bspc
  tab  q    w    e    r    t    y    u    i    o    p    [    ]    \
  caps a    s    d    f    g    h    j    k    l    ;    '    ret
  lsft z    x    c    v    b    n    m    ,    .    /    rsft
  lctl lmet lalt           spc            ralt rmet rctl
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that some keyboards have a Menu key instead of a right Meta key.
In this case you can use <code>menu</code> instead of <code>rmet</code>.</p>
</div>
<div class="paragraph">
<p>For non-US keyboards, see <a href="#non-us-keyboards">the non-US keyboards section</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="deflayer">deflayer</h3>
<div class="paragraph">
<p><strong>Reference</strong></p>
</div>
<div class="paragraph">
<p>Your configuration file must have at least one <code>deflayer</code> entry. This defines
how each physical key mapped in <code>defsrc</code> behaves when kanata runs.</p>
</div>
<div class="listingblock">
<div class="title">Syntax:</div>
<div class="content">
<pre class="highlight"><code>(deflayer $layer-name $action1 $action2 ... $actionN)</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$layer-name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A string representing the layer name.
This name is used to reference this layer in other actions.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$action</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The action that activates while this layer is active
when the corresponding <code>defsrc</code> input key is pressed.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Description</strong></p>
</div>
<div class="paragraph">
<p>A <code>deflayer</code> configuration entry is followed by the layer name then a list of
keys or actions. The usable key names are the same as in defsrc. Actions are
explained further on in this document. The whitespace story is the same as with
<code>defsrc</code>. The order of keys/actions in <code>deflayer</code> corresponds to the
physical key in the same sequence position defined in <code>defsrc</code>.</p>
</div>
<div class="paragraph">
<p>The first layer defined in your configuration file will be the starting layer
when kanata runs. Other layers can be temporarily activated or switched to
using actions.</p>
</div>
<div class="paragraph">
<p>An example <code>defsrc</code> and <code>deflayer</code> that remaps QWERTY to the Dvorak layout
would be:</p>
</div>
<div class="listingblock">
<div class="title">Example:</div>
<div class="content">
<pre class="highlight"><code>(defsrc
  grv  1    2    3    4    5    6    7    8    9    0    -    =    bspc
  tab  q    w    e    r    t    y    u    i    o    p    [    ]    \
  caps a    s    d    f    g    h    j    k    l    ;    '    ret
  lsft z    x    c    v    b    n    m    ,    .    /    rsft
  lctl lmet lalt           spc            ralt rmet rctl
)

(deflayer dvorak
  grv  1    2    3    4    5    6    7    8    9    0    [    ]    bspc
  tab  '    ,    .    p    y    f    g    c    r    l    /    =    \
  caps a    o    e    u    i    d    h    t    n    s    -    ret
  lsft ;    q    j    k    x    b    m    w    v    z    rsft
  lctl lmet lalt           spc            ralt rmet rctl
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>A <a href="#windows-only-tray-icon">Windows tray menu build</a> also allows specifying
layer icons in <code>deflayer</code> and <code>deflayermap</code> to show in the tray menu on layer activation,
see <a href="https://github.com/jtroo/kanata/blob/main/cfg_samples/tray-icon/tray-icon.kbd">example config</a></p>
</div>
<div class="sect3">
<h4 id="_deflayermap">deflayermap</h4>
<div class="paragraph">
<p><strong>Reference</strong></p>
</div>
<div class="paragraph">
<p>An alternative method for defining a layer exists: <code>deflayermap</code>.
This method maps inputs to actions by defining input-output pairs,
ignoring <code>defsrc</code> entirely.</p>
</div>
<div class="paragraph">
<p>You will likely want to either enable <a href="#process-unmapped-keys">process-unmapped-keys</a>
or define most of your keyboard keys within <a href="#defsrc">defsrc</a> when using <code>deflayermap</code>.
Otherwise many actions do not behave as intended.
See one of the links for more context.</p>
</div>
<div class="listingblock">
<div class="title">Syntax:</div>
<div class="content">
<pre class="highlight"><code>(deflayermap ($layer-name)
 $input1 $action1
 $input2 $action2
 ...
 $inputN $actionN)</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$layer-name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A string representing the layer name.
This name is used to reference this layer in other actions.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$input</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The input key mapped to the corresponding output.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$action</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The action that activates while this layer is active
when the corresponding input key is pressed.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Description</strong></p>
</div>
<div class="paragraph">
<p>The <code>deflayermap</code> variant has the advantage of terser configuration
when only a few keys on a layer need to be mapped.
When practicing a new configuration, the standard <code>deflayer</code> has an advantage
of looking more like a physical keyboard layout,
which may be helpful to some.</p>
</div>
<div class="paragraph">
<p>Within <code>deflayermap</code>, the very first item must be the layer name.
The layer name must be in parentheses unlike with <code>deflayer</code>.
After the layer name, the layer is configured via pairs of items:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>input key</p>
</li>
<li>
<p>output action</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>An example complete configuration that maps Caps Lock to Escape is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>;; defsrc is still necessary
(defsrc)
(deflayermap (base-layer)
  caps esc)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The input key takes the same role as <code>defsrc</code> keys.
The output action takes the role that items in the normal <code>deflayer</code> have.</p>
</div>
<div class="paragraph">
<p>As special input names,
you can use one of <code>&#95;</code>, <code>&#95;&#95;</code>, or <code>&#95;&#95;&#95;</code> to map all
the keys that are not explicitly mapped in the layer,
e.g. in the example above, these affect keys other than <code>caps</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 85.7143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&#95;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Map all unmapped keys in this layer that are defined in <code>defsrc</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&#95;&#95;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Map all unmapped keys in this layer that are not defined in <code>defsrc</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&#95;&#95;&#95;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Map all unmapped keys in this layer.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="review-of-required-configuration-entries">Review of required configuration entries</h3>
<div class="paragraph">
<p>If you&#8217;re reading in order, you have now seen all of the required entries:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>defsrc</code></p>
</li>
<li>
<p><code>deflayer</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>An example minimal configuration is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>(defsrc a b c)

(deflayer start 1 2 3)</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will make kanata remap your <code>a b c</code> keys to <code>1 2 3</code>. This is almost
certainly undesirable but is a valid configuration.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Please have a read through <a href="https://github.com/jtroo/kanata/blob/main/docs/platform-known-issues.adoc">the known platform issues</a>
because they may have implications on what you should include/exclude in <code>defsrc</code>.
The Windows LLHOOK I/O mechanism has the most issues by far.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="key-names">Key names for defsrc and deflayermap</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The source of truth for all default key names are the functions
<code>str_to_oscode</code> and <code>add_default_str_osc_mappings</code>
in the <a href="https://github.com/jtroo/kanata/blob/main/parser/src/keys/mod.rs">keys/mod.rs file</a>.</p>
</div>
<div class="paragraph">
<p><a href="https://www.toptal.com/developers/keycode">This online tool</a>
will also work for most keys to tell you the key name.
It will be shown as the <code>event.code</code> field in the web page
after you press the key.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="non-us-keyboards">Non-US keyboards</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For non-US keyboard users, you may have some keys on your keyboard with characters
that are not allowed in <code>defsrc</code> by default, at least according to the symbol shown
on the physical keys.
The two sections below can help you understand how to remap all your keys.</p>
</div>
<div class="sect2">
<h3 id="_browser_event_code">Browser event.code</h3>
<div class="paragraph">
<p>Ensure kanata and other key remapping programs are <strong>not</strong> running.
Then you can use <a href="https://www.toptal.com/developers/keycode">this online tool</a>
and press the key.
The <code>event.code</code> field tells you the key name to use in Kanata.
Alternatively, you can read through
<a href="https://www.w3.org/TR/uievents-code/">this reference</a>.
Due to the lengthy key names,
you may want to use <code>deflayermap</code> if remapping using these key names.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
On Windows, you should use either <code>kanata_winIOv2.exe</code>
or Interception when using key names according to the browser <code>event.code</code>.
The default <code>kanata.exe</code> does not do mappings according to the browser <code>event.code</code>
key names.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="deflocalkeys">deflocalkeys</h3>
<div class="paragraph">
<p><strong>Reference</strong></p>
</div>
<div class="paragraph">
<p>You can use <code>deflocalkeys</code> to define additional key names that can be
used in <code>defsrc</code>, <code>deflayer</code>, and anywhere else in the configuration.</p>
</div>
<div class="listingblock">
<div class="title">Syntax:</div>
<div class="content">
<pre class="highlight"><code>(deflocalkeys-$variant
  $key-name1 $key-number1
  $key-name2 $key-number2
  ...
  $key-nameN $key-numberN)</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$variant</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">One of: <code>win winiov2 wintercept linux macos</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$key-name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A key name of your choice that can be used in the rest of the configuration.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$key-number</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A key number that varies based on the kanata variant you are using.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Only one of each deflocalkeys-* variant is allowed. The variants that are not
applicable will be ignored, e.g. <code>deflocalkeys-linux</code> and <code>deflocalkeys-wintercept</code>
are both ignored when using the default Windows <code>kanata.exe</code> binary.</p>
</div>
<div class="paragraph">
<p><strong>Description</strong></p>
</div>
<div class="paragraph">
<p>The <code>deflocalkeys</code> configurations are not strictly necessary.
Their purpose is to help you match your physical keyboard&#8217;s appearance
to your kanata configuration,
in the hopes it will be more readable and less confusing.
In the underlying hardware, all keyboard positions send the same scan codes
according to their position, regardless of what is printed on the key cap.
The scan code names are typically referred to by the corresponding US layout name.
It is the job of the operating system to translate the same scan code
to the correct outputs according to the configured locale and layout.</p>
</div>
<div class="paragraph">
<p>You can find configurations that others have made in
<a href="https://github.com/jtroo/kanata/blob/main/docs/locales.adoc">this document</a>.
If you do not see your keyboard there and are not confident in using
the available tools,
please feel welcome to ask for help in a discussion or issue.
Please contribute to the document if you are able!</p>
</div>
<div class="paragraph">
<p>There are five variants of deflocalkeys:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>deflocalkeys-win</code></p>
</li>
<li>
<p><code>deflocalkeys-winiov2</code></p>
</li>
<li>
<p><code>deflocalkeys-wintercept</code></p>
</li>
<li>
<p><code>deflocalkeys-linux</code></p>
</li>
<li>
<p><code>deflocalkeys-macos</code></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Example:</div>
<div class="content">
<pre class="highlight"><code>(deflocalkeys-win
  Ã¬ 187
)

(deflocalkeys-winiov2
  Ã¬ 187
)

(deflocalkeys-wintercept
  Ã¬ 187
)

(deflocalkeys-linux
  Ã¬ 13
)

(deflocalkeys-macos
  Ã¬ 13
)

(defsrc
  grv  1    2    3    4    5    6    7    8    9    0    -    Ã¬    bspc
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The number used for a custom key represents the converted value for an OsCode in
base 10. This differs between Windows-hooks, Windows-interception, and Linux.</p>
</div>
<div class="paragraph">
<p>Running kanata with the <code>--debug</code> flag lets you read the correct number,
shown in parenthesis of <code>code</code> in the <code>KeyEvent</code> log lines.</p>
</div>
<div class="paragraph">
<p>It also possible to use native tools, as described below.</p>
</div>
<div class="paragraph">
<p>In Linux, <code>evtest</code> will give the correct number for the physical key you press.</p>
</div>
<div class="paragraph">
<p>In Windows using the default hook mechanism, the non-interception version of the
keyboard tester in the kanata repository will give the correct number
in the <code>code: &lt;number&gt;</code> section.
(<a href="https://github.com/jtroo/kanata/releases/tag/win-keycode-tester-v0.3.0">prebuilt binary</a>)</p>
</div>
<div class="paragraph">
<p>In Windows uning <code>winIOv2</code>, the winIOv2 executable variant
will give the correct number in the <code>code: &lt;number&gt;</code> section.</p>
</div>
<div class="paragraph">
<p>In Windows using Interception, the interception version of the keyboard tester
will give the correct number i the <code>num: &lt;number&gt;</code> section.
Between the hook and interception versions, some
keys may agree but others may not; do be aware that they are <strong>not</strong> compatible!</p>
</div>
<div class="paragraph">
<p>However, Interception and winIOv2 should generally agree with each other.</p>
</div>
<div class="paragraph">
<p>Ideas for improving the user-friendliness of this system are welcome! As
mentioned before, please ask for help in an issue or discussion if needed, and
help with <a href="https://github.com/jtroo/kanata/blob/main/docs/locales.adoc">this document</a>
is very welcome so that future users can have an easier time ðŸ™‚.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="introduction-defcfg">Introduction to defcfg</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Your configuration file may include a single <code>defcfg</code> entry.
The <code>defcfg</code> can be empty or omitted.
There are options that change kanata&#8217;s behaviour,
but this introduction will introduce
only the most prevalent entry: <code>process-unmapped-keys</code>.
All other options can be found later in the <a href="#optional-defcfg-options">defcfg options</a> section.</p>
</div>
<div class="listingblock">
<div class="title">Example of an empty defcfg:</div>
<div class="content">
<pre class="highlight"><code>(defcfg)</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="process-unmapped-keys">process-unmapped-keys</h3>
<div class="paragraph">
<p>The <code>process-unmapped-keys</code> option in <code>defcfg</code> is probably the most
generally impactful option.
Enabling this configuration makes kanata process keys
that are not defined in <code>defsrc</code>.
This might be useful
if you are only mapping a few keys in defsrc
instead of most of the keys on your keyboard.</p>
</div>
<div class="paragraph">
<p>By default, keys excluded from <code>defsrc</code> will not work in various scenarios.
Some examples:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The early hold for prior <code>tap-hold-press</code> actions will not</p>
</li>
<li>
<p>Prior <code>one-shot</code> actions will not be released</p>
</li>
<li>
<p><code>fork</code> and <code>switch</code> logic will not see the key</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This option is disabled by default.
The reason this is not enabled by default
is because some keys may not work correctly if they are intercepted.
For example, see <a href="#windows-only-windows-altgr">Windows only: windows-altgr</a>.</p>
</div>
<div class="listingblock">
<div class="title">Example:</div>
<div class="content">
<pre class="highlight"><code>(defcfg
  process-unmapped-keys yes
)</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_aliases_and_variables">Aliases and variables<a id="aliases-and-vars"></a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Before learning about actions,
it will be useful to first learn about aliases and variables.</p>
</div>
<div class="sect2">
<h3 id="aliases">Aliases</h3>
<div class="paragraph">
<p><strong>Reference</strong></p>
</div>
<div class="paragraph">
<p>Using the <code>defalias</code> configuration entry, you can introduce a shortcut label
for an action.</p>
</div>
<div class="listingblock">
<div class="title">Syntax:</div>
<div class="content">
<pre class="highlight"><code>(defalias
  $alias-name1 $action1
  $alias-name2 $action2
  ...
  $alias-nameN $actionN)</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$alias-name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The chosen name for the shortcut label for the action.
It can be used in the rest of the configuration
by prefixing the name with the <code>@</code> character.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$action</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The ouput action used wherever the alias name is referenced.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Description</strong></p>
</div>
<div class="paragraph">
<p>The <code>defalias</code> entry reads pairs of items in a sequence
where the first item in the pair is the alias name and the second item is the
action it can be substituted for.</p>
</div>
<div class="paragraph">
<p>A list is a sequence of strings
or nested lists separated by whitespace,
surrounded by parentheses.
All of the configuration entries we&#8217;ve looked at so far are lists;
<code>defalias</code> is where we&#8217;ll first see nested lists in this guide.</p>
</div>
<div class="listingblock">
<div class="title">Example:</div>
<div class="content">
<pre class="highlight"><code>(defalias
  ;; tap for caps lock, hold for left control
  cap (tap-hold 200 200 caps lctl)
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>This alias can be used in <code>deflayer</code> as a substitute for the long action. The
alias name is prefixed with <code>@</code> to signify that it&#8217;s an alias as opposed to a
normal key.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>(deflayer example
  @cap a s d f
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>You may have multiple <code>defalias</code> entries and multiple aliases within a single
<code>defalias</code>. Aliases may also refer to other aliases that were defined earlier
in the configuration file.</p>
</div>
<div class="listingblock">
<div class="title">Example:</div>
<div class="content">
<pre class="highlight"><code>(defalias one (tap-hold 200 200 caps lctl))
(defalias two (tap-hold 200 200 esc lctl))
(defalias
  three C-A-del ;; Ctrl+Alt+Del
  four (tap-hold 200 200 @three ralt)
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can choose to put actions without aliasing them right into <code>deflayer</code>.
However, for long actions it is recommended not to do so to keep a nice visual
alignment. Visually aligning your <code>deflayer</code> entries will hopefully make your
configuration file easier to read.</p>
</div>
<div class="listingblock">
<div class="title">Example:</div>
<div class="content">
<pre class="highlight"><code>(deflayer example
  ;; this is equivalent to the previous deflayer example
  (tap-hold 200 200 caps lctl) a s d f
)</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="variables">Variables</h3>
<div class="paragraph">
<p><strong>Reference</strong></p>
</div>
<div class="paragraph">
<p>Using the <code>defvar</code> configuration entry,
you can introduce a shortcut label for an arbitrary string or list.</p>
</div>
<div class="listingblock">
<div class="title">Syntax:</div>
<div class="content">
<pre class="highlight"><code>(defvar
  $var-name1 $var-value1
  $var-name2 $var-value2
  ...
  $var-nameN $var-valueN)</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$var-name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The chosen name for the shortcut label for the action.
It can be used in the rest of the configuration
by prefixing the name with the <code>@</code> character.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$var-value</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An arbitrary string or list that will be substituted
wherever the variable is used.
A variable can be used by prefixing the variable name with <code>$</code>.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Description</strong></p>
</div>
<div class="paragraph">
<p>Unlike an alias, a variable does not need to be a valid standalone action.
In other words,
a variable can be used as components of actions.</p>
</div>
<div class="paragraph">
<p>The most common use case is to define common number strings
for actions such as <code>tap-hold</code>, <code>tap-dance</code>, and <code>one-shot</code>.</p>
</div>
<div class="paragraph">
<p>Similar to how <code>defalias</code> works,
<code>defvar</code> reads pairs of items in a sequence
where the first item in the pair is the variable name
and the second item is a string or list.
Variables are allowed to refer to previously defined variables.</p>
</div>
<div class="paragraph">
<p>Variables can be used to substitute most values.
Some notable exceptions are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>variables cannot be used in <code>defcfg</code>, <code>defsrc</code>, or <code>deflocalkeys</code></p>
</li>
<li>
<p>variables cannot be used to substitute an action name</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Variables are referred to by prefixing their name with <code>$</code>.</p>
</div>
<div class="listingblock">
<div class="title">Example:</div>
<div class="content">
<pre class="highlight"><code>(defvar
  tap-timeout   100
  hold-timeout  200
  tt $tap-timeout
  ht $hold-timeout
)

(defalias
  th1 (tap-hold $tt $ht caps lctl)
  th2 (tap-hold $tt $ht spc  lsft)
)</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="concat-in-defvar">concat in defvar</h4>
<div class="paragraph">
<p>Within the second item of <code>defvar</code>,
a list that begins with the special keyword <code>concat</code> will concatenate all
subsequent items in the list together into a single string value.
Without using <code>concat</code>, lists are saved as-is.</p>
</div>
<div class="listingblock">
<div class="title">Example:</div>
<div class="content">
<pre class="highlight"><code>(defvar
  rootpath "/home/myuser/mysubdir"
  ;; $otherpath will be the string: /home/myuser/mysubdir/helloworld
  otherpath (concat $rootpath "/helloworld")
)</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="actions">Actions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The actions kanata provides are what make it truly customizable.
This section explains the available actions.</p>
</div>
<div class="sect2">
<h3 id="live-reload">Live reload</h3>
<div class="paragraph">
<p><strong>Reference</strong></p>
</div>
<div class="paragraph">
<p>Live reload variants:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>lrld</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String action that live-reloads the currently-used configuration file.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>lrld-next</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String action that live-reloads the configuration file specified
consecutively later in the command line order.
Cycles to the first-specified file
if currently using the last file specified.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>lrld-prev</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String action that live-reloads the configuration file specified
consecutively earlier in the command line order.
Cycles to the last-specified file
if currently using the first file specified.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>(lrld-num $n)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List action that live-reloads the n&#8217;th file
as specified in the command line order.
The first file specified is <code>n=1</code>.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Live reload does not read or apply changes to device-related configurations.
Examples of device-related configurations:
<code>linux-dev</code>, <code>macos-dev-names-include</code>, <code>linux-use-trackpoint-property</code>,
<code>windows-only-windows-interception-keyboard-hwids</code>.</p>
</div>
<div class="paragraph">
<p><strong>Description</strong></p>
</div>
<div class="paragraph">
<p>You can put the <code>lrld</code> action onto a key to live reload your configuration file.
If kanata can&#8217;t parse the file,
the previous configuration will continue to be used.
When live reload is activated,
the active kanata layer will be the first <code>deflayer</code> defined in the configuration.</p>
</div>
<div class="listingblock">
<div class="title">Example:</div>
<div class="content">
<pre class="highlight"><code>(deflayer has-live-reload
  lrld a s d f
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>There are variants of <code>lrld</code>: <code>lrld-prev</code> and <code>lrld-next</code>. These will cycle
through different configuration files that you specify on kanata&#8217;s startup.
The first configuration file specified will be the one loaded on startup.
The prev/next variants can be used with shortened names of <code>lrpv</code> and <code>lrnx</code> as
well.</p>
</div>
<div class="paragraph">
<p>Another variant is the list action <code>lrld-num</code>.
This reloads the configuration file specified by the number,
according to the order that the configuration file arguments
are passed into kanata&#8217;s startup command.</p>
</div>
<div class="listingblock">
<div class="title">Example:</div>
<div class="content">
<pre class="highlight"><code>(deflayer has-live-reloads
  lrld lrpv lrnx (lrld-num 3)
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Example specifying multiple config files in the command line:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>kanata -c startup.cfg -c 2nd.cfg -c 3rd.cfg</code></pre>
</div>
</div>
<div class="paragraph">
<p>Given the above startup command,
activating <code>(lrld-num 2)</code> would reload the <code>2nd.cfg</code> file.</p>
</div>
</div>
<div class="sect2">
<h3 id="layer-switch">layer-switch</h3>
<div class="paragraph">
<p><strong>Reference</strong></p>
</div>
<div class="paragraph">
<p>A list action that changes the active base layer.</p>
</div>
<div class="listingblock">
<div class="title">Syntax:</div>
<div class="content">
<pre class="highlight"><code>(layer-switch $layer-name)</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$layer-name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Layer name to switch to.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Description</strong></p>
</div>
<div class="paragraph">
<p>This action allows you to switch to another "base" layer.
This is permanent until a <code>layer-switch</code> to another layer is activated.
The concept of a base layer makes more sense
when looking at the next action: <code>layer-while-held</code>.</p>
</div>
<div class="paragraph">
<p>This action accepts a single subsequent string which must be a layer name
defined in a <code>deflayer</code> entry.</p>
</div>
<div class="listingblock">
<div class="title">Example:</div>
<div class="content">
<pre class="highlight"><code>(defalias dvk (layer-switch dvorak))</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="layer-while-held">layer-while-held</h3>
<div class="paragraph">
<p><strong>Reference</strong></p>
</div>
<div class="paragraph">
<p>A list action that changes the active layer while the key is held.</p>
</div>
<div class="listingblock">
<div class="title">Syntax:</div>
<div class="content">
<pre class="highlight"><code>(layer-while-held $layer-name)</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$layer-name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Layer name to activate while key is held.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Description</strong></p>
</div>
<div class="paragraph">
<p>This action allows you to temporarily change to another layer while the key
remains held. When the key is released, you go back to the currently active
"base" layer.</p>
</div>
<div class="paragraph">
<p>This action accepts a single subsequent string which must be a layer name
defined in a <code>deflayer</code> entry.</p>
</div>
<div class="listingblock">
<div class="title">Example:</div>
<div class="content">
<pre class="highlight"><code>(defalias nav (layer-while-held navigation))</code></pre>
</div>
</div>
<div class="paragraph">
<p>You may also use <code>layer-toggle</code> in place of <code>layer-while-held</code>; they behave
exactly the same. The <code>layer-toggle</code> name is slightly shorter but is a bit
inaccurate with regards to its meaning.</p>
</div>
</div>
<div class="sect2">
<h3 id="transparent-key">Transparent key</h3>
<div class="paragraph">
<p><strong>Reference</strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>_</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String action that activates the action of the layer "underneath" the active one.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Description</strong></p>
</div>
<div class="paragraph">
<p>If you use a single underscore for a key <code>_</code> then it acts as a "transparent"
key in a <code>deflayer</code>. The behaviour depends if <code>_</code> is on a base layer or a
while-held layer. When <code>_</code> is pressed on the active base layer, the key will
default to the corresponding <code>defsrc</code> key. If <code>_</code> is pressed on the active
while-held layer, the base layer&#8217;s behaviour will activate.</p>
</div>
</div>
<div class="sect2">
<h3 id="use-defsrc">use-defsrc</h3>
<div class="paragraph">
<p><strong>Reference</strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 85.7143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>use-defsrc</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String action that outputs the corresponding <code>defsrc</code> input key.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Description</strong></p>
</div>
<div class="paragraph">
<p>A similar concept to transparent key is the <code>use-defsrc</code> action.
When activated, the underlying <code>defsrc</code> key will be the output action.</p>
</div>
<div class="listingblock">
<div class="title">Example:</div>
<div class="content">
<pre class="highlight"><code>(defsrc a b c d)
(defalias src use-defsrc)
(deflayer remap-only-c-to-d
  _ _ d @src)</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="no-op">No-op</h3>
<div class="paragraph">
<p><strong>Reference</strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 85.7143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>XX</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String action that will output nothing.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Description</strong></p>
</div>
<div class="paragraph">
<p>You may use the action <code>XX</code> as a "no operation" key, meaning pressing the key
will do nothing. This might be desirable in place of a transparent key on a
layer that is not fully mapped so that a key that is intentionally not mapped
will do nothing as opposed to typing a letter.</p>
</div>
<div class="paragraph">
<p>Alternatively you can use <code>âœ—</code> <code>âˆ…</code> <code>â€¢</code> to mean no-op.</p>
</div>
<div class="listingblock">
<div class="title">Example:</div>
<div class="content">
<pre class="highlight"><code>(deflayer contains-no-ops
  XX âœ— âˆ… â€¢)</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="unicode">Unicode</h3>
<div class="paragraph">
<p><strong>Reference</strong></p>
</div>
<div class="paragraph">
<p>List action that outputs a single unicode codepoint.
The unicode codepoint will not be repeatedly typed if you hold the key down.</p>
</div>
<div class="listingblock">
<div class="title">Syntax:</div>
<div class="content">
<pre class="highlight"><code>(unicode $unicode-codepoint)</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$unicode-codepoint</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">One unicode codepoint.
Be warned that many emojis/glyphs/graphemes
are composed of multiple codepoints.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Description</strong></p>
</div>
<div class="paragraph">
<p>The <code>unicode</code> (or <code>ðŸ”£</code>) action accepts a single unicode character (but not
a composed character, so ðŸ¤², but not ðŸ¤²ðŸ¿).
If you want to output a glyph that is composed of multiple codepoints,
you can use <a href="#macro">macro</a> with multiple <code>unicode</code> actions.</p>
</div>
<div class="paragraph">
<p>You may use a unicode character as an alias if desired or in its simplified form <code>ðŸ”£ðŸ˜€</code>
(vs the usual <code>(ðŸ”£ ðŸ˜€)</code>).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The unicode action may not be correctly accepted by the active
application.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
If using Linux, make sure to look at the
<a href="#linux-only-linux-unicode-u-code">unicode behaviour customization</a> in defcfg.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Example:</div>
<div class="content">
<pre class="highlight"><code>(defalias
  sml (unicode ðŸ˜€)
  ðŸ˜€ (ðŸ”£ ðŸ˜€)
  ðŸ™ (unicode ðŸ™)
)
(deflayer has-happy-sad
  @sml @ðŸ™ @ðŸ˜€ ðŸ”£ðŸ˜€ d f
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you want output parentheses <code>( )</code> via unicode you can quote them.</p>
</div>
<div class="listingblock">
<div class="title">Example with parentheses</div>
<div class="content">
<pre class="highlight"><code>(defalias
  lp (unicode "(")
  rp (unicode ")")
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you want to output double quotes via unicode
you need a special quoting syntax.</p>
</div>
<div class="listingblock">
<div class="title">Example use of double-quote within a string</div>
<div class="content">
<pre class="highlight"><code>(defalias
  dq (unicode r#"""#)
)</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="output-chordscombos">Output chords/combos</h3>
<div class="paragraph">
<p><strong>Reference</strong></p>
</div>
<div class="paragraph">
<p>Prefixing a known key name with the following strings
will output the key alongside the specified modifier.
Multiple prefixes can be combined to add more modifiers
to the same key output.
Duplicate prefixes are not allowed.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 85.7143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>C-</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Left Control</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RC-</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Right Control</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>A-</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Left Alt</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RA-</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Right Alt, also known as AltGr</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AG-</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Also means Right Alt/AltGr</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>S-</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Left Shift</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RS-</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Right Shift</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>M-</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Left Meta</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RM-</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Right Meta</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>A special behaviour of output chords is that if another key is pressed,
all of the chord keys will be released
before the newly pressed key action activates.
The modifier keys are often not desired for subsequent actions
and without this behaviour,
rapid typing can result in undesired modified key presses.
If you want keys to remain pressed, use <a href="#multi">multi</a> instead.</p>
</div>
<div class="paragraph">
<p><strong>Description</strong></p>
</div>
<div class="paragraph">
<p>You may want to remap a key to automatically be pressed in combination with
modifiers such as Control or Shift.
Output chords are a way for you to achieve this.</p>
</div>
<div class="paragraph">
<p>Output chords are typically used do one-off actions such as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>type a symbol, e.g. <code>S-1</code> to output <code>!</code> for the US layout.</p>
</li>
<li>
<p>type an accented character,
e.g. <code>RA-a</code> to output <code>Ã¡</code> for the US international layout.</p>
</li>
<li>
<p>do a special action like <code>C-c</code> to send <code>SIGTERM</code> in the terminal</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It should be noted that output chords are not usable in all configuration items.
If you get an unknown key error where you expected an output chord to be usable,
you must split the output chord into its component keys.
For example, <code>(unmod C-l)</code> is an error;
instead you should use <code>(unmod lctl l)</code>.</p>
</div>
<div class="paragraph">
<p>The output chord prefix strings are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>C-</code>: Left Control (also <code>â€¹âŽˆ</code> <code>â€¹âŒƒ</code> or without the <code>â€¹</code> side indicator)</p>
</li>
<li>
<p><code>RC-</code>: Right Control (also <code>âŽˆâ€º</code> <code>âŒƒâ€º</code>)</p>
</li>
<li>
<p><code>A-</code>: Left Alt (also <code>â€¹âŽ‡</code> <code>â€¹âŒ¥</code> or without the <code>â€¹</code> side indicator))</p>
</li>
<li>
<p><code>RA-</code>: Right Alt, a.k.a. AltGr (also <code>AG</code> <code>âŽ‡â€º</code> <code>âŒ¥â€º</code>)</p>
</li>
<li>
<p><code>S-</code>: Left Shift (also <code>â€¹â‡§</code> or without the <code>â€¹</code> side indicator))</p>
</li>
<li>
<p><code>RS-</code>: Right Shift (also <code>â‡§â€º</code>)</p>
</li>
<li>
<p><code>M-</code>: Left Meta, a.k.a. Windows, GUI, Command, Super (also <code>â€¹âŒ˜</code> <code>â€¹â–</code> <code>â€¹â—†</code> or without the <code>â€¹</code> side indicator))</p>
</li>
<li>
<p><code>RM-</code>: Right Meta (also <code>âŒ˜â€º</code> <code>â–â€º</code> <code>â—†â€º</code>)</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Example:</div>
<div class="content">
<pre class="highlight"><code>(defalias
  ;; Type exclamation mark (US layout)
  ex! S-1
  ;; Ctrl+C: send SIGINT to a Linux terminal program
  int C-c
  ;; Win+Tab: open Windows' Task View
  tsk M-tab
  ;; Ctrl+Shift+(C|V): copy or paste from certain terminal programs
  cpy C-S-c
  pst C-S-v
)</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="repeat-key">Repeat key</h3>
<div class="paragraph">
<p><strong>Reference</strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rpt</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String action that outputs the single most-recently typed key.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rpt-any</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String action that outputs the most-recently outputted action.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Description</strong></p>
</div>
<div class="paragraph">
<p>The action <code>rpt</code> repeats the most recently typed key. Holding down this key
will not repeatedly send the key. The intended use case is to be able to use a
different finger or even thumb key to repeat a typed key, as opposed to
double-tapping a key.</p>
</div>
<div class="listingblock">
<div class="title">Example:</div>
<div class="content">
<pre class="highlight"><code>(deflayer has-repeat
  rpt a s d f
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>rpt</code> action only repeats the last key output.
For example, it won&#8217;t output a chord like <code>ctrl+c</code>
if the previous key pressed was <code>C-c</code>.
The <code>rpt</code> action will only output <code>c</code> in this case.</p>
</div>
<div class="paragraph">
<p>There is a variant <code>rpt-any</code>
which will repeat any previous action
and would output <code>ctrl+c</code> in the example case.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>(deflayer has-repeat-any
  rpt-any a s d f
)</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="release-a-key-or-layer">Release a key or layer</h3>
<div class="paragraph">
<p><strong>Reference</strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>(release-key $key)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List action that releases the defined key from output actions.
Notably this does not act on key inputs.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>(release-layer $layer-name)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List action that releases <code>layer-while-held</code> activations
for the given layer name.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Description</strong></p>
</div>
<div class="paragraph">
<p>You can release a held key or layer via these actions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>release-key</code> or <code>keyâ†‘</code>: release a key, accepts <code>defsrc</code> compatible names</p>
</li>
<li>
<p><code>release-layer</code> or <code>layerâ†‘</code>: release a while-held layer</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A lower-level detail of these actions is that they operate on output states
as opposed to virtually releasing an input key.
This does have some practical significance.
For example, if the action <code>(macro-repeat a 50)</code> were on the <code>a</code> key,
activating <code>(release-key a)</code> will not stop the repeating macro.</p>
</div>
<div class="paragraph">
<p>An example practical use case for <code>release-key</code> is seen in the <code>multi</code> section
directly below.</p>
</div>
<div class="paragraph">
<p>There is currently no known practical use case for
<code>release-layer</code>, but it exists nonetheless.</p>
</div>
</div>
<div class="sect2">
<h3 id="multi">multi</h3>
<div class="paragraph">
<p><strong>Reference</strong></p>
</div>
<div class="paragraph">
<p>Activate multiple actions in sequence.</p>
</div>
<div class="listingblock">
<div class="title">Syntax:</div>
<div class="content">
<pre class="highlight"><code>(multi $action1 $action2 ... $actionN)</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$action</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An output action.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Description</strong></p>
</div>
<div class="paragraph">
<p>The <code>multi</code> action executes multiple keys or actions in order but also
simultaneously. It accepts one or more actions.</p>
</div>
<div class="paragraph">
<p>An example use case is to press the "Alt" key while also activating another
layer.</p>
</div>
<div class="paragraph">
<p>In the example below, holding the physical "Alt" key will result in a held
layer being activated while also holding "Alt" itself. The held layer operates
nearly the same as the standard keyboard, so for example the sequence (hold
Alt)+(Tab+Tab+Tab) will work as expected. This is in contrast to having a layer
where <code>tab</code> is mapped to <code>A-tab</code>, which results in repeated press+release of
the two keys and has different behaviour than expected. Some special keys will
release the "Alt" key and do some other action that requires "Alt" to be
released. In other words, the "Alt" key serves a dual purpose of still
fulfilling the "Alt" key role for some button presses (e.g. Tab), but also as a
new layer for keys that aren&#8217;t typically used with "Alt" to have added useful
functionality.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>(defalias
  atl (multi alt (layer-while-held alted-with-exceptions))
  lft (multi (release-key alt) left) ;; release alt if held and also press left
  rgt (multi (release-key alt) rght) ;; release alt if held and also press rght
)

(defsrc
  alt  a    s    d    f
)

(deflayer base
  @atl _    _    _    _
)

(deflayer alted-with-exceptions
  _    _    _    @lft @rgt
)</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
This action can sometimes behave in surprising ways
with regards to simultaneity and order of actions.
For example, an action like <code>(multi sldr ')</code> will not behave as expected.
Due to implementation details, <code>sldr</code> will activate after the <code>'</code>
even though it is listed before.
This example could instead be written as <code>(macro sldr 10 ')</code>,
and that would work as intended.
It is recommended to avoid <code>multi</code> if it can be replaced
with a different action like <code>macro</code> or an output chord.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_reverse_release_order">reverse-release-order</h4>
<div class="paragraph">
<p><strong>Reference</strong></p>
</div>
<div class="paragraph">
<p>String item that can be used inside of <code>(multi &#8230;&#8203;)</code>
to reverse the release order of any keys that were pressed
as part of <code>multi</code>.</p>
</div>
<div class="listingblock">
<div class="title">Syntax:</div>
<div class="content">
<pre class="highlight"><code>(multi ... reverse-release-order)</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Description</strong></p>
</div>
<div class="paragraph">
<p>Within <code>multi</code> you can use include <code>reverse-release-order</code>
to do what the action states: reverse the typical release order from
if you have multiple keys in multi.</p>
</div>
<div class="paragraph">
<p>For example, pressing then releasing a key with the action:
<code>(multi a b c)</code> would press a b c in the stated order
and then release a b c in the stated order.
Changing it to <code>(multi a b c reverse-release-order)</code>
would press a b c in the stated order
and then release c b a in the stated order.</p>
</div>
<div class="listingblock">
<div class="title">Example:</div>
<div class="content">
<pre class="highlight"><code>(defalias
  S-a-reversed (multi lsft a reverse-release-order)
)</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="mouse-actions">Mouse actions</h3>
<div class="paragraph">
<p>You can click the left, middle, and right buttons using kanata actions, do
vertical/horizontal scrolling, and move the mouse.</p>
</div>
<div class="sect3">
<h4 id="mouse-buttons">Mouse buttons</h4>
<div class="paragraph">
<p><strong>Reference</strong></p>
</div>
<div class="paragraph">
<p>You can activate mouse actions with the string actions below.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mlft</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hold left mouse button.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mmid</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hold middle mouse button.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mrgt</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hold right mouse button.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mfwd</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hold forward mouse button.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mbck</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hold backward mouse button.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mltp</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tap left mouse button.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mmtp</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tap middle mouse button.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mrtp</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tap right mouse button.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mftp</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tap forward mouse button.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mbtp</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tap backward mouse button.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>In Linux and Windows-Interception,
the hold actions can be used within <code>defsrc</code> and <code>deflayermap</code>
to remap mouse buttons like keyboard keys.</p>
</div>
<div class="paragraph">
<p><strong>Description</strong></p>
</div>
<div class="paragraph">
<p>The mouse button actions are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>mlft</code>: left mouse button</p>
</li>
<li>
<p><code>mmid</code>: middle mouse button</p>
</li>
<li>
<p><code>mrgt</code>: right mouse button</p>
</li>
<li>
<p><code>mfwd</code>: forward mouse button</p>
</li>
<li>
<p><code>mbck</code>: backward mouse button</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The mouse button will be held while the key mapped to it is held.
Using Linux and Windows-Interception,
the above actions are also usable in <code>defsrc</code>
to enable remapping specified mouse actions in your layers,
like you would with keyboard keys.</p>
</div>
<div class="paragraph">
<p>If there are multiple mouse click actions within a single multi action, e.g.</p>
</div>
<div class="paragraph">
<p><code>(multi mrgt mlft)</code></p>
</div>
<div class="paragraph">
<p>then all the buttons except the last will be clicked then unclicked. The last
button will remain held until key release. In the example above, pressing then
releasing the key mapped to this action will result in the following event
sequence:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>press key mapped to <code>multi</code></p>
</li>
<li>
<p>click right mouse button</p>
</li>
<li>
<p>unclick right mouse button</p>
</li>
<li>
<p>click left mouse button</p>
</li>
<li>
<p>release key mapped to <code>multi</code></p>
</li>
<li>
<p>release left mouse button</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>There are variants of the standard mouse buttons which "tap" the button. Rather
than holding the button while the key is held, a mouse click will be
immediately followed by the release. Nothing happens when the key is released.
The actions are as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>mltp</code>: tap left mouse button</p>
</li>
<li>
<p><code>mmtp</code>: tap middle mouse button</p>
</li>
<li>
<p><code>mrtp</code>: tap right mouse button</p>
</li>
<li>
<p><code>mftp</code>: tap forward mouse button</p>
</li>
<li>
<p><code>mbtp</code>: tap bacward mouse button</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="mouse-wheel">Mouse wheel</h4>
<div class="paragraph">
<p><strong>Reference</strong></p>
</div>
<div class="paragraph">
<p>The <code>mwheel-*</code> actions allow you to emulate a mouse wheel.
Holding the action will repeatedly scroll
according to the action configuration.</p>
</div>
<div class="listingblock">
<div class="title">Syntax:</div>
<div class="content">
<pre class="highlight"><code>(mwheel-$variant $interval $distance)</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$variant</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">One of <code>up down left right</code> representing the scroll direction to use.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$interval</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of milliseconds between scroll actions.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$distance</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Distance to travel per activation.
The number <code>120</code> represents a complete notch on
standard resolution mice and in some environments,
120 or a multiple of it should be what is used.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>You may use these key names within <code>defsrc</code>
to remap scroll events as if they were keys,
corresponding to up, down, left, right respectively:
<code>mwu</code>, <code>mwd</code>, <code>mwl</code>, <code>mwr</code>.</p>
</div>
<div class="paragraph">
<p><strong>Description</strong></p>
</div>
<div class="paragraph">
<p>The mouse wheel actions are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>mwheel-up</code> or <code>ðŸ–±â˜¸â†‘</code>: vertical scroll up</p>
</li>
<li>
<p><code>mwheel-down</code> or <code>ðŸ–±â˜¸â†“</code>: vertical scroll down</p>
</li>
<li>
<p><code>mwheel-left</code> or <code>ðŸ–±â˜¸â†</code>: horizontal scroll left</p>
</li>
<li>
<p><code>mwheel-right</code> or <code>ðŸ–±â˜¸â†’</code>: horizontal scroll right</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>All of these actions accept two number strings. The first is the interval
(unit: ms) between scroll actions. The second number is the distance
(unit: arbitrary). In both Windows and Linux, 120 distance units is equivalent
to a notch movement on a physical wheel. You can play with the parameters to
see what feels correct to you. Both numbers must be in the range [1,65535].</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
In Linux, not all desktop environments support the <code>REL_WHEEL_HI_RES</code> event.
If this is the case for yours,
it will likely be a better experience to use a distance value that is a multiple of 120.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>On Linux and Interception, you can also choose to read from a mouse device.
When doing so, using the <code>mwu</code>, <code>mwd</code>, <code>mwl</code>, <code>mwr</code> key names in <code>defsrc</code>
allow you to remap the mouse scroll up/down/left/right actions like you would
with keyboard keys.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
If you are using a high-resolution mouse in Linux,
only a full "notch" of the scroll wheel will activate the action.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
If you are using a high-resolution mouse with Interception,
you will probably get way more events than you intended.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="mouse-movement">Mouse movement</h4>
<div class="paragraph">
<p><strong>Reference</strong></p>
</div>
<div class="paragraph">
<p>The <code>movemouse-*</code> actions allow you to move the mouse cursor.
Holding the action will repeatedly move the cursor
according to the configuration.</p>
</div>
<div class="listingblock">
<div class="title">Syntax:</div>
<div class="content">
<pre class="highlight"><code>(movemouse-$variant $interval $distance)</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$variant</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">One of <code>up down left right</code> representing the direction to move.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$interval</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of milliseconds between move activations.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$distance</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Distance to travel per activation in unit of pixels.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>There is a move mouse variant that increases distance per activation
at a constant rate until a maximum is reached.</p>
</div>
<div class="listingblock">
<div class="title">Syntax:</div>
<div class="content">
<pre class="highlight"><code>(movemouse-accel-$variant $interval $acceleration-time $min $max)</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$variant</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">One of <code>up down left right</code> representing the direction to move.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$interval</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of milliseconds between move activations.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$acceletaion-time</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of milliseconds until max distance per activation is reached.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$min</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Initial distance to travel per activation in unit of pixels.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$max</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maximum distance to travel per activation in unit of pixels.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Description</strong></p>
</div>
<div class="paragraph">
<p>The mouse movement actions are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>movemouse-up</code> or <code>ðŸ–±â†‘</code></p>
</li>
<li>
<p><code>movemouse-down</code> or <code>ðŸ–±â†“</code></p>
</li>
<li>
<p><code>movemouse-left</code> or <code>ðŸ–±â†</code></p>
</li>
<li>
<p><code>movemouse-right</code> or <code>ðŸ–±â†’</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Similar to the mouse wheel actions, all of these actions accept two number strings.
The first is the interval (unit: ms) between movement actions and the second number
is the distance (unit: pixels) of each movement.</p>
</div>
<div class="paragraph">
<p>The following are variants of the above mouse movements that apply linear mouse
acceleration from the minimum distance to the maximum distance as the mapped key is held.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>movemouse-accel-up</code> or <code>ðŸ–±accelâ†‘</code></p>
</li>
<li>
<p><code>movemouse-accel-down</code> or <code>ðŸ–±accelâ†“</code></p>
</li>
<li>
<p><code>movemouse-accel-left</code> or <code>ðŸ–±accelâ†</code></p>
</li>
<li>
<p><code>movemouse-accel-right</code> or <code>ðŸ–±accelâ†’</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>All these actions accept four number strings. The first number is the
interval (unit: ms) between movement actions. The second number is the time it
takes (unit: ms) to linearly ramp up from the minimum distance to the maximum
distance. The third and fourth numbers are the minimum and maximum distances
(unit: pixels) of each movement.</p>
</div>
<div class="paragraph">
<p>There is a toggable defcfg option related to <code>movemouse-accel</code> - <a href="#movemouse-inherit-accel-state">movemouse-inherit-accel-state</a>. You might want to enable it, especially if you&#8217;re coming from QMK.</p>
</div>
</div>
<div class="sect3">
<h4 id="set-mouse">Set absolute mouse position</h4>
<div class="paragraph">
<p>The action <code>setmouse</code> or <code>setðŸ–±</code> sets the absolute mouse position.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
This is only supported in Windows right now.
For an interesting keyboard-centric mouse solution in Linux,
try looking at
<a href="https://github.com/rvaiya/warpd">warpd</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This list action takes two parameters which are <code>x</code> and <code>y</code> positions
of the absolute movement.
The values go from 0,0 which is the upper-left corner of the screen
to 65535,65535 which is the lower-right corner of the screen.
If you have multiple monitors,
<code>setmouse</code> treats them all as a single large screen.
This can make it a little confusing for how to set the <code>x, y</code> values
to get the positions that you want.
Experimentation will be needed.</p>
</div>
</div>
<div class="sect3">
<h4 id="mouse-speed">Modify the speed of mouse movements</h4>
<div class="paragraph">
<p>The action <code>movemouse-speed</code> or <code>ðŸ–±speed</code> modifies the speed at which <code>movemouse</code> and
<code>movemouse-accel</code> function at runtime. It does this by expanding or shrinking
<code>min_distance</code> and <code>max_distance</code> while the action key is pressed.</p>
</div>
<div class="paragraph">
<p>This action accepts one number (unit: percentage) by which the
mouse movements will be accelerated.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
Due to the nature of pixels being whole numbers, some values such as
33 may not result in an exact third of the distance.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Example:</div>
<div class="content">
<pre class="highlight"><code>(defalias
  fst (movemouse-speed 200)
  slw (movemouse-speed 50)
)</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="mouse-all-actions-example">Mouse all actions example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>(defalias
  mwu (mwheel-up 50 120)
  mwd (mwheel-down 50 120)
  mwl (mwheel-left 50 120)
  mwr (mwheel-right 50 120)

  msâ†‘ (movemouse-up 1 1)
  msâ† (movemouse-left 1 1)
  msâ†“ (movemouse-down 1 1)
  msâ†’ (movemouse-right 1 1)

  maâ†‘ (movemouse-accel-up 1 1000 1 5)
  maâ† (movemouse-accel-left 1 1000 1 5)
  maâ†“ (movemouse-accel-down 1 1000 1 5)
  maâ†’ (movemouse-accel-right 1 1000 1 5)

  sm (setmouse 32228 32228)

  fst (movemouse-speed 200)
)

(deflayer mouse
  _    @mwu @mwd @mwl @mwr _    _    _    _    _    @maâ†‘ _    _    _
  _    pgup bck  _    fwd  _    _    _    _    @maâ† @maâ†“ @maâ†’ _    _
  _    pgdn mlft _    mrgt mmid _    mbck mfwd _    @msâ†‘ _    _
  @fst _    mltp _    mrtp mmtp _    mbtp mftp @msâ† @msâ†“ @msâ†’
  _    _    _              _              _    _    _
)</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="tap-dance">tap-dance</h3>
<div class="paragraph">
<p><strong>Reference</strong></p>
</div>
<div class="paragraph">
<p>The <code>tap-dance</code> action allows performing different actions
based on number of consecutive taps of the same key.</p>
</div>
<div class="listingblock">
<div class="title">Syntax:</div>
<div class="content">
<pre class="highlight"><code>(tap-dance $timeout $action-list)</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$timeout</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of milliseconds after which the tap-dance ends.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$action-list</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A list of actions that can be selected, ordered by number of taps.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The <code>tap-dance-eager</code> variant will eagerly perform actions.
Use of <code>macro</code> and <code>bspc</code> can help to backtrack for the 2nd tap onwards.</p>
</div>
<div class="listingblock">
<div class="title">Syntax:</div>
<div class="content">
<pre class="highlight"><code>(tap-dance-eager $timeout $action-list)</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Description</strong></p>
</div>
<div class="paragraph">
<p>The <code>tap-dance</code> action allows repeated tapping of a key to result in
different actions. It is followed by a timeout (unit: ms) and a list
of keys or actions. Each time the key is pressed, its timeout will reset. The
action will be chosen if one of the following events occur:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the timeout expires</p>
</li>
<li>
<p>a different key is pressed</p>
</li>
<li>
<p>the key is repeated up to the final action</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You may put normal keys or other actions in <code>tap-dance</code>.</p>
</div>
<div class="listingblock">
<div class="title">Example:</div>
<div class="content">
<pre class="highlight"><code>(defalias
  ;; 1 tap : "A" key
  ;; 2 taps: Control+C
  ;; 3 taps: Switch to another layer
  ;; 4 taps: Escape key
  td (tap-dance 200 (a C-c (layer-switch l2) esc))
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>There is a variant of <code>tap-dance</code> with the name <code>tap-dance-eager</code>. The variant
is parsed identically but the difference is that it will activate every
action in the sequence as the taps progress.</p>
</div>
<div class="paragraph">
<p>In the example below, repeated taps will, in order:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>type <code>a</code></p>
</li>
<li>
<p>erase the <code>a</code> and type <code>bb</code></p>
</li>
<li>
<p>erase the <code>bb</code> and type <code>ccc</code></p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>(defalias
  td2 (tap-dance-eager 500 (
    (macro a) ;; use macro to prevent auto-repeat of the key
    (macro bspc b b)
    (macro bspc bspc c c c)
  ))
)</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="one-shot">one-shot</h3>
<div class="paragraph">
<p><strong>Reference</strong></p>
</div>
<div class="paragraph">
<p>Activate keys or layers for a time without keeping the input key held,
for one subsequent key.
Activating other one-shot actions,
while one or more are already active,
will reset the timeout,
and overlap the one-shot actions.</p>
</div>
<div class="listingblock">
<div class="title">Syntax:</div>
<div class="content">
<pre class="highlight"><code>($one-shot-variant $timeout $action)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Values for <code>$variant</code>:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>one-shot-press</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">End on the first press of another key.
This is also the variant selected by the name <code>one-shot</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>one-shot-release</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">End on the first release of a newly pressed key.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>one-shot-press-pcancel</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">End on the first press of another key
  or on re-press of another active one-shot key</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>one-shot-release-pcancel</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">End on the first release of a newly pressed key
  or on re-press of another active one-shot key.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Other items:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$timeout</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of milliseconds after which
if not deactivated due to user input,
one-shot will deactivate on its own.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$action</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Layer action, key, or output chord.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Description</strong></p>
</div>
<div class="paragraph">
<p>The <code>one-shot</code> action is similar to "sticky keys", if you know what that is.
This activates an action or key until either the timeout expires or a different
key is used. The <code>one-shot</code> action must be followed by a timeout (unit:
ms) and another key or action.</p>
</div>
<div class="paragraph">
<p>Some of the intended use cases are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>press a modifier for exactly one following key press</p>
</li>
<li>
<p>switch to another layer for exactly one following key press</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If a <code>one-shot</code> key is held then it will act as the regular key. E.g. holding
a key assigned with <code>@os2</code> in the example below will keep Left Shift held for
every key, not just one, as long as it&#8217;s still physically pressed.</p>
</div>
<div class="paragraph">
<p>Pressing multiple <code>one-shot</code> keys in a row within the timeout will combine
the actions of those keys and reset the timeout to the value of the most
recently pressed <code>one-shot</code> key.</p>
</div>
<div class="paragraph">
<p>There are four variants of the <code>one-shot</code> action:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>one-shot-press</code> or <code>one-shotâ†“</code>:
end on the first press of another key</p>
</li>
<li>
<p><code>one-shot-release</code> or <code>one-shotâ†‘</code>:
end on the first release of another key</p>
</li>
<li>
<p><code>one-shot-press-pcancel</code> or <code>one-shotâ†“â¤«</code>:
end on the first press of another key
or on re-press of another active one-shot key</p>
</li>
<li>
<p><code>one-shot-release-pcancel</code> or <code>one-shotâ†‘â¤«</code>:
end on the first release of another key
or on re-press of another active one-shot key</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It is important to note that the first activation of a one-shot key
determines the behaviour with regards to the 4 variants
for all subsequent one-shot key activations,
even if a following one-shot key has a different configuration
than the initial key pressed.</p>
</div>
<div class="paragraph">
<p>The default name <code>one-shot</code> corresponds to <code>one-shot-press</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
When using one-shot with keys that will trigger defoverrides,
you will likely want to adjust <a href="#override-release-on-activation">override-release-on-activation</a> to yes in <code>defcfg</code>.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Example:</div>
<div class="content">
<pre class="highlight"><code>(defalias
  os1 (one-shot 500 (layer-while-held another-layer))
  os2 (one-shot-press 2000 lsft)
  os3 (one-shot-release 2000 lctl)
  os4 (one-shot-press-pcancel 2000 lalt)
  os5 (one-shot-release-pcancel 2000 lmet)
)</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="one-shot-pause-processing">one-shot-pause-processing</h4>
<div class="paragraph">
<p><strong>Reference</strong></p>
</div>
<div class="paragraph">
<p>Pause <code>one-shot</code> processing of new input keypresses for a time,
to allow actions that are not intended to consume <code>one-shot</code>
to take place.</p>
</div>
<div class="listingblock">
<div class="title">Syntax:</div>
<div class="content">
<pre class="highlight"><code>(one-shot-pause-processing $time)</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>time</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of milliseconds to ignore processing.
Something notable is that one virtual key press or releas
(tap is a separate press and subsequent release)
will take 1ms to process.
If using virtual keys this number must be larger
than the number of virtual key events that are taking place.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Description</strong></p>
</div>
<div class="paragraph">
<p>The <code>one-shot-pause-processing</code> list action allows you to pause the
key press processing of one-shot activations.
An example of when this is useful the following sequence:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Activate a layer-while-held</p>
</li>
<li>
<p>Activate a one-shot action on that layer</p>
</li>
<li>
<p>Release the layer-while-held key, which has an <code>(on-release &#8230;&#8203;)</code> action
associated with it.</p>
</li>
<li>
<p>The on-release action is not intended to consume one-shot activations</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In the scenario above, by default the on-release activation
would trigger deactivation of one-shot;
thus the pause processing action must be used to stop this from happening.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="tap-hold">tap-hold</h3>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
The <code>tap-hold</code> action and all variants can behave unexpectedly on Linux
with respect to repeat of antecedent key presses.
The full context is in <a href="https://github.com/jtroo/kanata/discussions/422">discussion #422</a>.
In brief, the workaround is to use <code>tap-hold</code> inside of <a href="#multi">multi</a>,
combined with another key action that behaves as a no-op like <code>f24</code>.<br>
Example: <code>(multi f24 (tap-hold &#8230;&#8203;))</code>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Reference</strong></p>
</div>
<div class="paragraph">
<p>The <code>tap-hold</code> action lets you activate different actions
depending it a key is tapped or held.</p>
</div>
<div class="listingblock">
<div class="title">Syntax:</div>
<div class="content">
<pre class="highlight"><code>(tap-hold $tap-timeout $hold-timeout $tap-action $hold-action)</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$tap-timeout</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of milliseconds for the window that a tap into re-press with hold
results in the <code>$tap-action</code> being held.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$hold-timeout</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of milliseconds after which the <code>$hold-action</code> activates.
Releasing the key before this elapses
results in <code>$tap-action</code> activating.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$tap-action</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Action to activate when the input is determined to be a "tap".</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$hold-action</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Action to activate when the input is determined to be a "hold".</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">Variants:</div>
<div class="content">
<pre>(tap-hold-press $tap-timeout $hold-timeout $tap-action $hold-action)
(tap-hold-release $tap-timeout $hold-timeout $tap-action $hold-action)
(tap-hold-press-timeout $tap-timeout $hold-timeout $tap-action $hold-action $timeout-action)
(tap-hold-release-timeout $tap-timeout $hold-timeout $tap-action $hold-action $timeout-action)
(tap-hold-release-keys $tap-timeout $hold-timeout $tap-action $hold-action $tap-keys)
(tap-hold-except-keys $tap-timeout $hold-timeout $tap-action $hold-action $tap-keys)</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$tap-hold-press</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Activate <code>$hold-action</code> early if held and another input key is pressed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$tap-hold-release</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Activate <code>$hold-action</code> early if held and another input key is pressed and released.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$tap-hold-press-timeout</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Activate <code>$hold-action</code> if held and another input key is pressed.
If the defined timeout elapses, <code>$timeout-action</code> will activate.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$tap-hold-release-timeout</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Activate <code>$hold-action</code> early if held and another input key is pressed and released.
If the defined timeout elapses, <code>$timeout-action</code> will activate.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$tap-hold-release-keys</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Activate <code>$hold-action</code> early if held and another input key is pressed and released.
The <code>$tap-keys</code> parameter is a list of key names.
Activates <code>$tap-action</code> early if a key within <code>$tap-keys</code> is pressed before hold activates.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$tap-hold-except-keys</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <code>$tap-keys</code> parameter is a list of key names.
Activates <code>$tap-action</code> early if a key within <code>$tap-keys</code> is pressed before hold activates.
No key is ever output unless the key is released or another key is pressed,
which differs from the default <code>tap-hold</code> behaviour.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Description</strong></p>
</div>
<div class="paragraph">
<p>The <code>tap-hold</code> action allows you to have one action/key for a "tap" and a
different action/key for a "hold". A tap is a rapid press then release of the
key whereas a hold is a long press.</p>
</div>
<div class="paragraph">
<p>The action takes 4 parameters in the listed order:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>tap timeout (unit: ms)</p>
</li>
<li>
<p>hold timeout (unit: ms)</p>
</li>
<li>
<p>tap action</p>
</li>
<li>
<p>hold action</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The tap timeout is the number of milliseconds within which a rapid
press+release+press of a key will result in the tap action being held instead
of the hold action activating.</p>
</div>
<details>
<summary class="title">Tap timeout in more detail</summary>
<div class="content">
<div class="paragraph">
<p>The way a <code>tap-hold</code> action works with respect to the tap timeout
is often unclear to newcomers.
To make it concrete, the output event sequence of the <code>tap-hold</code> action
<code>(tap-hold $tap-timeout 200 a lctl)</code>
for varying values of <code>$tap-timeout</code>
with a fixed input event sequence will be described.</p>
</div>
<div class="paragraph">
<p>The input event sequence is:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>press</p>
</li>
<li>
<p>50 ms elapses</p>
</li>
<li>
<p>release</p>
</li>
<li>
<p>50 ms elapses</p>
</li>
<li>
<p>press</p>
</li>
<li>
<p>300 ms elapses</p>
</li>
<li>
<p>release</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>With <code>(defvar $tap-timeout 0)</code>, the output event sequence is:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>50 ms elapses</p>
</li>
<li>
<p>press <code>a</code></p>
</li>
<li>
<p>release <code>a</code></p>
</li>
<li>
<p>250 ms elapses</p>
</li>
<li>
<p>press <code>lctl</code></p>
</li>
<li>
<p>100 ms elapses</p>
</li>
<li>
<p>release <code>lctl</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The above output sequence is the same for all <code>$tap-timeout</code> values
between and including <code>0</code> and <code>99</code>.</p>
</div>
<div class="paragraph">
<p>For a value of <code>100</code> or greater for <code>$tap-timeout</code>,
the output event sequence is instead:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>50 ms elapses</p>
</li>
<li>
<p>press <code>a</code></p>
</li>
<li>
<p>release <code>a</code></p>
</li>
<li>
<p>50 ms elapses</p>
</li>
<li>
<p>press <code>a</code></p>
</li>
<li>
<p>300 ms elapses</p>
</li>
<li>
<p>release <code>a</code></p>
</li>
</ul>
</div>
</div>
</details>
<div class="paragraph">
<p>The hold timeout is the number of milliseconds after which the hold action will
activate.</p>
</div>
<div class="paragraph">
<p>There are two additional variants of <code>tap-hold</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>tap-hold-press</code> or <code>tapâ¬“â†“</code></p>
<div class="ulist">
<ul>
<li>
<p>If there is a press of a different key, the hold action is activated even if
the hold timeout hasn&#8217;t expired yet</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>tap-hold-release</code> or <code>tapâ¬“â†‘</code></p>
<div class="ulist">
<ul>
<li>
<p>If there is a press+release of a different key, the hold action is activated
even if the hold timeout hasn&#8217;t expired yet</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>These variants may be useful if you want more responsive tap-hold keys,
but you should be wary of activating the hold action unintentionally.</p>
</div>
<div class="listingblock">
<div class="title">Example:</div>
<div class="content">
<pre class="highlight"><code>(defalias
  anm (tap-hold         200 200 a @num) ;; tap: a      hold: numbers layer
  oar (tap-hold-press   200 200 o @arr) ;; tap: o      hold: arrows layer
  ech (tap-hold-release 200 200 e @chr) ;; tap: e      hold: chords layer
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>There are further additional variants of <code>tap-hold-press</code> and <code>tap-hold-release</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>tap-hold-press-timeout</code> or <code>tapâ¬“â†“timeout</code></p>
</li>
<li>
<p><code>tap-hold-release-timeout</code> or <code>tapâ¬“â†‘timeout</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These variants take a 5th parameter, in addition to the same 4 as the other
variants. The 5th parameter is another action, which will activate if the hold
timeout expires as opposed to being triggered by other key actions, whereas the
non <code>-timeout</code> variants will activate the hold action in both cases.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>tap-hold-release-keys</code> or <code>tapâ¬“â†‘keys</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This variant takes a 5th parameter which is a list of keys
that trigger an early tap
when they are pressed while the <code>tap-hold-release-keys</code> action is waiting.
Otherwise this behaves as <code>tap-hold-release</code>.</p>
</div>
<div class="paragraph">
<p>The keys in the 5th parameter correspond to the physical input keys,
or in other words the key that corresponds to <code>defsrc</code>.
This is in contrast to the <code>fork</code> and <code>switch</code> actions
which operates on outputted keys, or in other words the outputs
that are in <code>deflayer</code>, <code>defalias</code>, etc. for the corresponding <code>defsrc</code> key.</p>
</div>
<div class="listingblock">
<div class="title">Example:</div>
<div class="content">
<pre class="highlight"><code>(defalias
  ;; tap: o    hold: arrows layer    timeout: backspace
  oat (tap-hold-press-timeout   200 200 o @arr bspc)
  ;; tap: e    hold: chords layer    timeout: esc
  ect (tap-hold-release-timeout 200 200 e @chr esc)
  ;; tap: u    hold: misc layer      early tap if any of: (a o e) are pressed
  umk (tap-hold-release-keys 200 200 u @msc (a o e))
)</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>tap-hold-except-keys</code> or <code>tap-holdâ¤«keys</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This variant takes a 5th parameter which is a list of keys
that always trigger a tap
when they are pressed while the <code>tap-hold-except-keys</code> action is waiting.
No key is ever output until there is either a release of the key or any other
key is pressed. This differs from <code>tap-hold</code> behaviour.</p>
</div>
<div class="paragraph">
<p>The keys in the 5th parameter correspond to the physical input keys,
or in other words the key that corresponds to <code>defsrc</code>.
This is in contrast to the <code>fork</code> and <code>switch</code> actions
which operates on outputted keys, or in other words the outputs
that are in <code>deflayer</code>, <code>defalias</code>, etc. for the corresponding <code>defsrc</code> key.</p>
</div>
<div class="listingblock">
<div class="title">Example:</div>
<div class="content">
<pre class="highlight"><code>(defalias
  ;; tap: o    hold: arrows layer    timeout: backspace
  oat (tap-hold-press-timeout   200 200 o @arr bspc)
  ;; tap: e    hold: chords layer    timeout: esc
  ect (tap-hold-release-timeout 200 200 e @chr esc)
  ;; tap: u    hold: misc layer      always tap if any of: (a o e) are pressed
  umk (tap-hold-except-keys 200 200 u @msc (a o e))
)</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="macro">macro</h3>
<div class="paragraph">
<p><strong>Reference</strong></p>
</div>
<div class="paragraph">
<p>The macro action taps the configured sequence of keys or actions.
Numbers can be used to delay the sequence by the defined number of milliseconds.</p>
</div>
<div class="listingblock">
<div class="title">Syntax:</div>
<div class="content">
<pre class="highlight"><code>(macro $macro-action1 $macro-action2 ... $macro-actionN)</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$macro-action</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A delay, key, action within the subset allowed within macros,
or an output-chord-prefixed list of more macro-actions.</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">Variants:</div>
<div class="content">
<pre>(macro-release-cancel ...)
(macro-cancel-on-press ...)
(macro-release-cancel-and-cancel-on-press ...)
(macro-repeat ...)
(macro-repeat-$cancel-variant ...)</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>macro-release-cancel</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cancel all active macros if the key is released.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>macro-cancel-on-press</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cancel all active macros if a different key is pressed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>macro-release-cancel-and-cancel-on-press</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cancel all active macros if either the key is released or a different key is pressed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>macro-repeat</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Repeat the macro while held.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>macro-repeat-$cancel-variant</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Repeat the macro while held.
Cancels the final repeat according the the behaviour of one of the variants:
<code>release-cancel</code>, <code>cancel-on-press</code>, <code>release-cancel-and-cancel-on-press</code>.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Description</strong></p>
</div>
<div class="paragraph">
<p>The <code>macro</code> action will tap a sequence of keys with optional
delays. This is different from <code>multi</code> because in the <code>multi</code> action,
all keys are held, whereas in <code>macro</code>, keys are pressed then released.</p>
</div>
<div class="paragraph">
<p>This means that with <code>macro</code> you can have some letters capitalized and others
not. This is not possible with <code>multi</code>.</p>
</div>
<div class="paragraph">
<p>The <code>macro</code> action accepts one or more keys, some actions, chords, and delays
(unit: ms).  It also accepts a list prefixed with <a href="#output-chordscombos">output chord</a>
modifiers where the list is subject to the aforementioned restrictions. The
number keys will be parsed as delays, so they must be aliased to be used in a macro.</p>
</div>
<div class="paragraph">
<p>Up to 4 macros can be active at the same time.</p>
</div>
<div class="paragraph">
<p>The actions supported in <code>macro</code> are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#cmd">cmd</a></p>
</li>
<li>
<p><a href="#unicode">unicode</a></p>
</li>
<li>
<p><a href="#mouse-actions">mouse actions</a></p>
</li>
<li>
<p><a href="#repeat-key">repeat</a></p>
</li>
<li>
<p><a href="#live-reload">live reload</a></p>
</li>
<li>
<p><a href="#virtual-keys">virtual key actions</a></p>
</li>
<li>
<p><a href="#sequences">sequence leader</a></p>
</li>
<li>
<p><a href="#arbitrary-code">arbitrary keycode</a></p>
</li>
<li>
<p><a href="#dynamic-macro">dynamic macro</a></p>
</li>
<li>
<p><a href="#unmod">unmod</a></p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Some of these actions may need short delays between.
For example, <code>(macro a (unmod b) 5 (unmod c) d))</code>
needs the delay of <code>5</code> to work correctly.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Example:</div>
<div class="content">
<pre class="highlight"><code>(defalias
  : S-;
  8 8
  0 0
  ðŸ™ƒ (unicode ðŸ™ƒ)

  ;; Type "http://localhost:8080"
  lch (macro h t t p @: / / 100 l o c a l h o s t @: @8 @0 @8 @0)

  ;; Type "I am HAPPY my FrIeNd ðŸ™ƒ"
  hpy (macro S-i spc a m spc S-(h a p p y) spc m y S-f r S-i e S-n d spc @ðŸ™ƒ)

  ;; alt-tab(x3) and alt-shift-tab(x3) with macro
  tfd (macro A-(tab 200 tab 200 tab))
  tbk (macro A-S-(tab 200 tab 200 tab))
)</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="macro-release-cancel">macro-release-cancel</h4>
<div class="paragraph">
<p>The <code>macro-release-cancel</code> variant of the <code>macro</code> action
will cancel all active macros
upon releasing the key.
Shorter unicode variant: <code>macroâ†‘â¤«</code>.
This variant is parsed identically to the non-cancelling version.
An example use case for this action is holding down
a key to get different outputs,
similar to tap-dance but one can see which keys are being outputted.</p>
</div>
<div class="paragraph">
<p>E.g. in the example below, when holding the key, first <code>1</code> is typed, then
replaced by <code>!</code> after 500ms, and finally that is replaced by <code>@</code> after another
500ms. However, if the key is released, the last character typed will remain
and the rest of the macro does not run.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>(defalias
  1 1

  ;; macro-release-cancel to output different characters with visual feedback
  ;; after holding for different amounts of time.
  1!@ (macro-release-cancel @1 500 bspc S-1 500 bspc S-2)
)</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="macro-cancel-on-press">macro-cancel-on-press</h4>
<div class="paragraph">
<p>The <code>macro-cancel-on-press</code> variant of the <code>macro action</code>
enables a cancellation trigger for all active macros including itself,
which is activated when a physical press of any other key happens.
The trigger is enabled while the macro is in progress.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>(defalias
  1 1
  1!@ (macro-cancel-on-press @1 500 bspc S-1 500 bspc S-2)
)</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="macro-release-cancel-and-cancel-on-press">macro-release-cancel-and-cancel-on-press</h4>
<div class="paragraph">
<p>The <code>macro-release-cancel-and-cancel-on-press</code> variant
combines the cancel behaviours
of both the release-cancel and cancel-on-press.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>(defalias
  1 1
  1!@ (macro-release-cancel-and-cancel-on-press @1 500 bspc S-1 500 bspc S-2)
)</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="macro-repeat">macro-repeat</h4>
<div class="paragraph">
<p>There are further <code>macro-repeat</code> variants of the three <code>macro</code> actions described previously.
These variants repeat while held.
The repeat will only occur once all macros have completed,
including the held macro key.
If multiple repeating macros are being held simulaneously,
only the most recently pressed macro will be repeated.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>(defalias
  mr1 (macro-repeat mltp)
  mr2 (macro-repeat-release-cancel mltp)
  mr3 (macro-repeat-cancel-on-press mltp)
  mr4 (macro-repeat-release-cancel-and-cancel-on-press mltp)
)</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="dynamic-macro">dynamic-macro</h3>
<div class="paragraph">
<p><strong>Reference</strong></p>
</div>
<div class="paragraph">
<p>Record and replay key inputs.</p>
</div>
<div class="listingblock">
<div class="title">Syntax:</div>
<div class="content">
<pre class="highlight"><code>(dynamic-macro-record $id)
(dynamic-macro-play   $id)
(dynamic-macro-record-stop)
(dynamic-macro-record-stop-truncate $count)</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>dynamic-macro-record</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Record a dynamicro macro which will be saved with the defined <code>$id</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>dynamic-macro-play</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Play back a macro saved with the defined <code>$id</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>dynamic-macro-record-stop</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stop and save a macro recording.
This can also be achieved by recording a new macro
or re-pressing record with the same <code>$id</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>dynamic-macro-record-stop-truncate</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stop and save a macro recording while truncating <code>$count</code> events
from the end of the recording.
This can be useful if the record/stop button is on a different layer.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Description</strong></p>
</div>
<div class="paragraph">
<p>The dynamic-macro actions allow for recording and playing key presses. The
dynamic macro records physical key presses, as opposed to kanata&#8217;s outputs.
This allows the dynamic macro to replicate any action, but it means that if
the macro starts and ends on different layers, then the macro might not be
properly repeatable.</p>
</div>
<div class="paragraph">
<p>The action <code>dynamic-macro-record</code> accepts one number (0-65535), which represents
the macro ID. Activating this action will begin recording physical key inputs.
If <code>dynamic-macro-record</code> with the same ID is pressed again, the recording will
end and be saved. If <code>dynamic-macro-record</code> with a different ID is pressed then
the current recording will end and be saved, then a new recording with the new
ID will begin.</p>
</div>
<div class="paragraph">
<p>The action <code>dynamic-macro-record-stop</code> will stop and save any active recording.
There is a variant of this:
<code>dynamic-macro-record-stop-truncate</code>
This is a list action that takes a single parameter:
the number of key actions to remove at the end of a dynamic macro.
This variant is useful if the macro stop button is on a different layer.</p>
</div>
<div class="paragraph">
<p>The action <code>dynamic-macro-play</code> accepts one number (0-65535), which represents
the macro ID. Activating this action will play the saved recording of physical
keys from a previous <code>dynamic-macro-record</code> with the same macro ID, if it exists.</p>
</div>
<div class="paragraph">
<p>One can nest dynamic macros within each other, e.g. activate
<code>(dynamic-macro-play 1)</code> while recording with <code>(dynamic-macro-record 0)</code>.
However, dynamic macros cannot recurse; e.g. activating <code>(dynamic-macro-play 0)</code>
while recording with <code>(dynamic-macro-record 0)</code> will be ignored.</p>
</div>
<div class="listingblock">
<div class="title">Example:</div>
<div class="content">
<pre class="highlight"><code>(defalias
  dr0 (dynamic-macro-record 0)
  dr1 (dynamic-macro-record 1)
  dr2 (dynamic-macro-record 2)
  dp0 (dynamic-macro-play 0)
  dp1 (dynamic-macro-play 1)
  dp2 (dynamic-macro-play 2)
  dms dynamic-macro-record-stop
  dst (dynamic-macro-record-stop-truncate 1)
)</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="caps-word">caps-word</h3>
<div class="paragraph">
<p><strong>Reference</strong></p>
</div>
<div class="paragraph">
<p>The <code>caps-word</code> action puts Kanata into a state where
typed keys are automatically shifted by <code>lsft</code>.
The state persists until terminated by timeout
or by typing a key that ends the state.
Typing a non-terminating key refreshes the timeout duration.</p>
</div>
<div class="paragraph">
<p>The <code>-toggle</code> variants will end the caps-word state
if pressed while caps-word is active,
whereas the re-pressing the standard variants
will keep the state active and refresh the timeout duration.</p>
</div>
<div class="listingblock">
<div class="title">Syntax:</div>
<div class="content">
<pre class="highlight"><code>(caps-word $timeout)
(caps-word-toggle $timeout)
(caps-word-custom $timeout $shifted-list $non-terminal-list)
(caps-word-custom-toggle $timeout $shifted-list $non-terminal-list)</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$timeout</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of milliseconds after which the caps-word state ends.
The duration is refreshed upon typing a non-terminating character.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$shifted-list</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of keys that will be automatically shifted.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$non-terminal-list</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of keys that are not shifted
but which do not terminate the caps-word state.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Description</strong></p>
</div>
<div class="paragraph">
<p>The <code>caps-word</code> or <code>wordâ‡ª</code> action triggers a state where the <code>lsft</code> key
will be added to the active key list
when a set of specific keys are active.
The keys are: <code>a-z</code> and <code>-</code>, which will be outputted as <code>A-Z</code> and <code>_</code>
respectively when using the US layout.</p>
</div>
<div class="paragraph">
<p>Examples where this is helpful
is capitalizing a single important word
like in <code>IMPORTANT!</code>
or defining a constant in code
like <code>const P99_99_VALUE: &#8230;&#8203;</code>.
This has an advantage over the regular caps lock
because it automatically ends
so it doesn&#8217;t need to be toggled off manually,
and it also shifts <code>-</code> to <code>_</code>
which caps lock does not do.</p>
</div>
<div class="paragraph">
<p>The <code>caps-word</code> state ends when the keyboard is idle
for the duration of the defined timeout (1st parameter),
or a terminating key is pressed.
Every key is a terminating key
except the keys which get capitalized
and the extra keys in this list:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>0-9</code></p>
</li>
<li>
<p><code>kp0-kp9</code></p>
</li>
<li>
<p><code>bspc del</code></p>
</li>
<li>
<p><code>up down left rght</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can use <code>caps-word-custom</code> or <code>wordâ‡ª-custom</code> instead of <code>caps-word</code>
if you want to manually define which keys are capitalized (2nd parameter)
and what the extra non-terminal+non-capitalized keys should be (3rd parameter).</p>
</div>
<div class="listingblock">
<div class="title">Example:</div>
<div class="content">
<pre class="highlight"><code>(defalias
  cw (caps-word 2000)

  ;; This example is similar to the default caps-word behaviour but it moves the
  ;; 0-9 keys to the capitalized key list from the extra non-terminating key list.
  cwc (caps-word-custom
    2000
    (a b c d e f g h i j k l m n o p q r s t u v w x y z 0 1 2 3 4 5 6 7 8 9)
    (kp0 kp1 kp2 kp3 kp4 kp5 kp6 kp7 kp8 kp9 bspc del up down left rght)
  )
)</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_caps_word_toggle">caps-word-toggle<a id="caps-word-toggle"></a></h4>
<div class="paragraph">
<p>There are <code>-toggle</code> variants of the <code>caps-word</code> actions.
By default re-pressing <code>caps-word</code> will keep <code>caps-word</code> active.
The <code>-toggle</code> variants will end <code>caps-word</code> if it is currently active,
otherwise <code>caps-word</code> will be activate as normal.</p>
</div>
<div class="listingblock">
<div class="title">Example:</div>
<div class="content">
<pre class="highlight"><code>(defalias
  cwt (caps-word-toggle 2000)
  cct (caps-word-custom-toggle
    2000
    (a b c d e f g h i j k l m n o p q r s t u v w x y z 0 1 2 3 4 5 6 7 8 9)
    (kp0 kp1 kp2 kp3 kp4 kp5 kp6 kp7 kp8 kp9 bspc del up down left rght)
  )
)</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_unmod">unmod<a id="unmod"></a></h3>
<div class="paragraph">
<p><strong>Reference</strong></p>
</div>
<div class="paragraph">
<p>The <code>unmod</code> action will dactivate modifier keys while outputting
one or more defined keys.</p>
</div>
<div class="listingblock">
<div class="title">Syntax:</div>
<div class="content">
<pre class="highlight"><code>(unmod $key1 $key2 ... $keyN)
(unmod ($mod1 $mod2 ... $modN) $key1 $key2 ... $keyN)</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$key</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A key name to output while unmodded.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$mod</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">By default <code>unmod</code> will deactivate all modifier keys.
An optional list as the first parameter
allows specfying a subset of modifiers to deactivate during the action.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Description</strong></p>
</div>
<div class="paragraph">
<p>The <code>unmod</code> action will release all modifiers temporarily
and send one or more keys.
After the <code>unmod</code> key is released, the released modifiers are pressed again.
The affected modifiers are: <code>lsft,rsft,lctl,rctl,lmet,rmet,lalt,ralt</code>.</p>
</div>
<div class="paragraph">
<p>A variant of <code>unmod</code> is <code>unshift</code> or <code>unâ‡§</code>.
This action only releases the <code>lsft,rsft</code> keys.
This can be useful for forcing unshifted keys while AltGr is still held.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
In case the modifiers to be undone are not part of <code>defsrc</code>,
<a href="#process-unmapped-keys">process-unmapped-keys</a> needs to be enabled in <code>defcfg</code> in order for their
states to be tracked correctly.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Example:</div>
<div class="content">
<pre class="highlight"><code>(defalias
  ;; holding shift and tapping a @um1 key will still output 1.
  um1 (unmod 1)
  ;; dead keys Ã© (as opposed to using AltGr) that outputs Ã‰ when shifted
  dkÃ© (macro (unmod ') e)

  ;; In ISO German QWERTZ, force unshifted symbols even if shift is held
  { (unshift ralt 7)
  [ (unshift ralt 8)
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>An list may optionally be used as the first parameter of <code>unmod</code>.
The list must be non-empty and must contain only modifier keys,
which are the keys in the affected modifiers list from earlier in this document section.</p>
</div>
<div class="paragraph">
<p>When this list exists, the action will temporarily release only the keys listed
rather than all modifiers.</p>
</div>
<div class="listingblock">
<div class="title">Example:</div>
<div class="content">
<pre class="highlight"><code>(defalias
	;; only unshift the alt keys
	unalt-a (unmod (lalt ralt) a)
)</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="fork">fork</h3>
<div class="paragraph">
<p><strong>Reference</strong></p>
</div>
<div class="paragraph">
<p>The fork action allows choosing between a default and an alternate action
based on whether specific keys are active.</p>
</div>
<div class="listingblock">
<div class="title">Syntax:</div>
<div class="content">
<pre class="highlight"><code>(fork $left-action $right-action $right-trigger-keys)</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$left-action</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Action to activate by default.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$right-action</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Action to activate if any of <code>$right-trigger-keys</code> are active.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$right-trigger-keys</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of keys that, if active when fork activates,
causes <code>$right-action</code> to happen in place of <code>$left-action</code>.</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
The keys <code>nop0-nop9</code> can be used as no-op outputs that
can still be checked within <code>fork</code>, unlike what <code>XX</code> does.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="switch">switch</h3>
<div class="paragraph">
<p><strong>Reference</strong></p>
</div>
<div class="paragraph">
<p>The <code>switch</code> action allows conditionally activating 0 or more actions,
depending on conditional checks.</p>
</div>
<div class="listingblock">
<div class="title">Syntax:</div>
<div class="content">
<pre class="highlight"><code>(switch
  $logic-check1 $action1 $post-activate1
  $logic-check2 $action2 $post-activate2
  ...
  $logic-checkN $actionN $post-activateN)</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$logic-check</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The condition, which if it evaluates to true,
will trigger the corresponding action.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$action</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Action to activate when logic evaluates to true.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$post-activate</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Valid values are <code>fallthrough</code> and <code>break</code>.
With <code>fallthrough</code>, when an action activates
switch will continue evaluating further logic checks
and potentially trigger more actions.
With <code>break</code>, further actions will not activate.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The logic check is a list.
The items within the list can either be key names or a special list check.
A key name item evaluates to true if that key name
is a currently active key output of Kanata upon activating <code>switch</code>
The outer-most list evaluates to true as whole
if any of the items evaluates to true.</p>
</div>
<div class="listingblock">
<div class="title">Syntax of logic check:</div>
<div class="content">
<pre class="highlight"><code>($item1 $item2 ... $itemN)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Syntax of special checks:</div>
<div class="content">
<pre class="highlight"><code>(or  $item1 $item2 ... $itemN)
(and $item1 $item2 ... $itemN)
(not $item1 $item2 ... $itemN)
(key-history $key-name $recency)
(key-timing  $recency $comparator $time)
(input         $input-type $key-name)
(input-history $input-type $key-name $recency)
(layer      $layer-name)
(base-layer $layer-name)</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>or</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Evaluates to true if any <code>$item</code> is true.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>and</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Evaluates to true if all of <code>$item</code> are true.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>not</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Evaluates to true if all of <code>$item</code> are false.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>key-history</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Evaluates to true if the key in the <code>$recency</code> slot matches <code>$key-name</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>key-timing</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The valid values for <code>$comparator</code> are <code>less-than</code> and <code>greater-than</code>,
with <code>lt</code> and <code>gt</code> as shorthand if desired.
This item evaluates to true if the key with the corresponding <code>$recency</code>
was pressed â€” for <code>lt</code> more recently than, or for <code>gt</code> later than â€”
the defined <code>$time</code> with unit milliseconds.
A <code>$recency</code> of 1 is the most recent key pressed according to Kanata processing.
The max recency is 8.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>input</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Evaluates to true if the <code>$key-name</code> is currently pressed.
The <code>$input-type</code> must be either <code>real</code> or <code>virtual</code>.
If using <code>real</code>, this will check against the defsrc inputs.
If using <code>virtual</code>, this will check against virtual key activations.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>input-history</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Evaluates to true if the input in the <code>$recency</code> slot matches <code>$key-name</code>.
Two input types use the same history with respect to recency slots.
A <code>$recency</code> of 1 is the most recent input i.e. the input activating <code>switch</code> itself.
The max recency is 8.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>layer</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Evaluates to true if the active layer matches <code>$layer-name</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>base-layer</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Evaluates to true if the most-recently-switched-to layer
from a <code>layer-switch</code> action matches <code>$layer-name</code>.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Description</strong></p>
</div>
<div class="paragraph">
<p>Conceptually, the <code>switch</code> action is similar to <a href="#fork">fork</a>
but has more capabilities as well as more complexity.
The <code>switch</code> action accepts multiple cases.
One case is a triple of:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>logic check</p>
</li>
<li>
<p>action: to activate if logic check evaluates to true</p>
</li>
<li>
<p><code>fallthrough|break</code>: choose to continue vs. stop evaluating cases</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The default use of the logic check behaves similarly to fork.</p>
</div>
<div class="paragraph">
<p>For example, the the logic check <code>(a b c)</code> will activate the corresponding action
if any of a, b, or c are currently pressed.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
the keys <code>nop0-nop9</code> can be used as no-op outputs that
can still be checked within <code>switch</code>, unlike what <code>XX</code> does.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The logic check also accepts the boolean operators <code>and|or|not</code> to allow more
complex use cases.</p>
</div>
<div class="paragraph">
<p>The order of cases matters.
For example, if two different cases match the currently pressed keys,
the case listed earlier in the configuration will activate first.
If the early case uses break, the second case will not activate.
Otherwise if fallthrough is used,
the second case will activate sequentially after the first case.
This idea generalizes to more than two cases,
but the two case example is hopefully simple and effective enough.</p>
</div>
<div class="listingblock">
<div class="title">Example:</div>
<div class="content">
<pre class="highlight"><code>(defalias
  swt (switch
    ;; case 1
    ((and a b (or c d) (or e f))) @ac1 break
    ;; case 2
    (a b c) @ac2 fallthrough
    ;; case 3
    () @ac3 break
  )
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Below is a description of how this example behaves.</p>
</div>
<div class="sect3">
<h4 id="_case_1">Case 1</h4>
<div class="listingblock">
<div class="content">
<pre>((and a b (or c d) (or e f))) a break</pre>
</div>
</div>
<div class="paragraph">
<p>Translating case 1&#8217;s logic check to some other common languages
might look like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>(a &amp;&amp; b &amp;&amp; (c || d) &amp;&amp; (e || f))</pre>
</div>
</div>
<div class="paragraph">
<p>If the logic check passes, the action <code>@ac1</code> will activate.
No other action will activate since <code>break</code> is used.</p>
</div>
</div>
<div class="sect3">
<h4 id="_cases_2_and_3">Cases 2 and 3</h4>
<div class="listingblock">
<div class="content">
<pre>(a b c) c fallthrough
() b break</pre>
</div>
</div>
<div class="paragraph">
<p>Case 2&#8217;s key check behaves like that of <code>fork</code>, i.e.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>(or a b c)</pre>
</div>
</div>
<div class="paragraph">
<p>or for some other common languages:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>a || b || c</pre>
</div>
</div>
<div class="paragraph">
<p>If this logic check passes and the case 1 does not pass,
the action <code>@ac2</code> will activate first.
Since the logic check of case 3 always passes, <code>@ac3</code> will activate next.</p>
</div>
<div class="paragraph">
<p>If neither case 1 or case 2 pass their logic checks,
case 3 will always activate with <code>@ac3</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="key-history-and-key-timing">key-history and key-timing</h4>
<div class="paragraph">
<p>In addition to simple keys there are two list items
that can be used within the case logic check
that compare against your typed key history:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>key-history</code></p>
</li>
<li>
<p><code>key-timing</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>key-history</code> item compares the order that keys were typed.
It accepts, in order:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a key</p>
</li>
<li>
<p>the key recency</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The key recency must be in the range 1-8,
where 1 is the most recent key that was pressed
and 8 is 8th most recent key pressed.</p>
</div>
<div class="listingblock">
<div class="title">Example:</div>
<div class="content">
<pre class="highlight"><code>(defalias
  swh (switch
    ((key-history a 1)) S-a break
    ((key-history b 1)) S-b break
    ((key-history c 1)) S-c break
    ((key-history d 8)) (macro d d d) break
    () XX break
  )
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>key-timing</code> compares how long ago recent key typing events occurred.
It accepts, in order,</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the key recency</p>
</li>
<li>
<p>a comparison string, which is one of: <code>less-than|greater-than|lt|gt</code></p>
</li>
<li>
<p>number of milliseconds to compare against</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The key recency must be in the range 1-8,
where 1 is the most recent key that was pressed
and 8 is 8th most recent key pressed.
Most use cases are expected to use a value of 1 for this parameter,
but perhaps you can find a creative use for the other values.</p>
</div>
<div class="paragraph">
<p>The comparison string determines how the actual key event timing
will be compared to the provided timing.</p>
</div>
<div class="paragraph">
<p>The number of milliseconds must be 0-65535.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
The maximum milliseconds value of this configuration item
across your whole configuration
will be a lower bound of how long it takes for kanata to become idle
and stop processing its state machine every approximately 1ms.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Example:</div>
<div class="content">
<pre class="highlight"><code>(defalias
  swh (switch
    ((key-timing 1 less-than 200)) S-a break
    ((key-timing 1 greater-than 500)) S-b break
    ((key-timing 2 lt 1000)) S-c break
    ((key-timing 8 gt 2000)) (macro d d d) break
    () XX break
  )
)</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_not">not</h4>
<div class="paragraph">
<p>The examples presented so far have not included the <code>not</code> boolean operator.
This operator will now be discussed.
Syntactically, the <code>not</code> operator is used similarly to <code>or|and</code>.
Functionally, it means "not <strong>any</strong> of" the list elements.</p>
</div>
<div class="listingblock">
<div class="title">Example:</div>
<div class="content">
<pre class="highlight"><code>(defalias
  swn (switch
    ((not x y z)) S-a break
    ;; the above and below cases are equivalent in logic
    ((not (or x y z))) S-a break
  )
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>In potentially more familiar notation, both cases have the logic:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>!(x || y || z)</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_input">input</h4>
<div class="paragraph">
<p>Until now, all <code>switch</code> logic has been associated to key code outputs.
It is also possible to operate on inputs.
Inputs can be either real keys or "virtual" (fake) keys.</p>
</div>
<div class="listingblock">
<div class="title">Example:</div>
<div class="content">
<pre class="highlight"><code>(defalias switch-input-example
  (switch
    ((input real lctl)) $ac1 break
    ((input virtual vk1)) $ac2 break
    () $ac3 break
  )
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Similar to <code>key-history</code> for regular active keys, <code>input-history</code> also exists.
A perhaps surprising, but hopefully logical, behaviour of input-history
when compared to key-history is that, at the time of switch activation,
the history of <code>input-history</code> for recency <code>1</code> will be the just-pressed input.
In other words recency <code>1</code> is the input activating the <code>switch</code> action itself.
Whereas with <code>key-history</code> for example, the key that will be next outputted
may determined by the switch logic itself, so is not in the history.
The consequence of this is that you should use a recency of <code>2</code>
when referring to the previously pressed input
because the current input is in the recency <code>1</code> slot.</p>
</div>
<div class="listingblock">
<div class="title">Example:</div>
<div class="content">
<pre class="highlight"><code>(defalias switch-input-history-example
  (switch
    ((input-history real lsft 2)) $var1 break
    ((input-history virtual vk2 2)) $var1 break
    () $ac3 break
  )
)</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_layer">layer</h4>
<div class="paragraph">
<p>The <code>layer</code> list item can be used in <code>switch</code> logic to operate on the active layer.
It accepts a single layer name
and evaluates to true if the configured layer name is the active layer,
otherwise it evaluates to false.</p>
</div>
<div class="listingblock">
<div class="title">Example:</div>
<div class="content">
<pre class="highlight"><code>(defalias switch-layer-example
  (switch
     ((layer base)) x break
    ((layer other)) y break
                 () z break
  )
)</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_base_layer">base-layer</h4>
<div class="paragraph">
<p>The <code>base-layer</code> list item evaluates to true
if the configured layer name is the base layer.
The base layer is the most recently switched-to layer
from a <code>layer-switch</code> action,
or the first layer defined in your configuration
if <code>layer-switch</code> has never been activated.</p>
</div>
<div class="listingblock">
<div class="title">Example:</div>
<div class="content">
<pre class="highlight"><code>(defalias switch-layer-example
  (switch
     ((base-layer base)) x break
    ((base-layer other)) y break
                 () z break
  )
)</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="cmd">cmd</h3>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
This action does not work unless you use the appropriate binary
or - if compiling yourself - the appropriate feature flag.
Additionally you must add the <a href="#danger-enable-cmd">danger-enable-cmd</a> <code>defcfg</code> option.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Reference</strong></p>
</div>
<div class="paragraph">
<p>The <code>cmd</code> action allows you to execute arbitrary binaries with arbitrary arguments.
The <code>cmd-log</code> variant behaves similarly but allows customization
of the stdout and stderr log levels within Kanata&#8217;s output logging.
The <code>cmd-output-keys</code> is like <code>cmd</code>, but stdout of the command
will be parsed as a list of keys, output chords, and delays similar to <a href="#macro">macro</a>
and be typed as kanata outputs.</p>
</div>
<div class="listingblock">
<div class="title">Syntax:</div>
<div class="content">
<pre class="highlight"><code>(cmd $binary $arg1 $arg2 ... $argN)
(cmd-log $stdout-log-level $stderr-log-level)
(cmd-output-keys $binary $arg1 $arg2 ... $argN)</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$binary</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Executable binary to run.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$arg</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Argument passed into the binary.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$stdout-log-level</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Log level for stdout of the command. Must be <code>debug</code>, <code>info</code>, <code>warn</code>, <code>error</code>, or <code>none</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$stdout-log-level</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Log level for stderr of the command. Must be <code>debug</code>, <code>info</code>, <code>warn</code>, <code>error</code>, or <code>none</code>.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Description</strong></p>
</div>
<div class="paragraph">
<p>The <code>cmd</code> action executes a program with arguments. It accepts one or more
strings. The first string is the program that will be run and the following
strings are arguments to that program. The arguments are provided to the
program in the order written in the config file.
Lists may also be used within <code>cmd</code>
which you may desire to do for reuse via <code>defvar</code>.
Lists will be flattened such that arguments are provided to the program
in the order written in the config file, regardless of list nesting.
To be technical, it would be a depth-first flattening (similar to DFS).</p>
</div>
<div class="paragraph">
<p>Commands are executed directly and not via a shell, so you cannot make
use of environment variables or symbols with special meaning.
For example <code>~</code> or <code>$HOME</code> in Linux will not be
substituted with your home directory.
If you want to execute with a shell program
use the shell as the first parameter, e.g. <code>bash</code> or <code>powershell.exe</code>.</p>
</div>
<div class="paragraph">
<p>The user executing the command
is the user that kanata was started with.
For example, if kanata was started by root,
the command will be run by the root user.
If you need to execute as a different user,
on Unix platforms you can use <code>sudo -u USER</code>
before the rest of your command to achieve this.</p>
</div>
<div class="listingblock">
<div class="title">Example:</div>
<div class="content">
<pre class="highlight"><code>(defalias
  cm1 (cmd rm -fr /tmp/testing)

  ;; You can use bash -c and then a quoted string to execute arbitrary text in
  ;; bash. All text within double-quotes is treated as a single string.
  cm2 (cmd bash -c "echo hello world")

  ;; You can prefix commands with sudo -u USER
  ;; to execute commands as a different user.
  cm3 (cmd sudo -u other_user bash -c "echo goodbye")
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default, <code>cmd</code> logs start of command, completion of command, stdout, and stderr.
Using the variant <code>cmd-log</code>, these log levels can be changed, and even disabled.
It takes two arguments, <code>&lt;log_level&gt;</code> and <code>&lt;error_log_level&gt;</code>. <code>&lt;log_level&gt;</code>
will be the level where the command to run, stdout, and stderr are logged.
The error channel is logged only if there is a failure with running the
command (typically if the command can&#8217;t be found, or there is trouble spawning it).</p>
</div>
<div class="paragraph">
<p>The valid levels are <code>debug</code>, <code>info</code>, <code>warn</code>, <code>error</code>, and <code>none</code>.</p>
</div>
<div class="listingblock">
<div class="title">Example:</div>
<div class="content">
<pre class="highlight"><code>(defalias
  ;; The first two arguments are the log levels, then just the normal command
  ;; This will only error if `bash` is not found or something else goes
  ;; wrong with the initial execution. Any logs produced by bash will not
  ;; be shown.
  noisy-cmd (cmd-log none error bash -c "echo hello this produces a log")

  ;; This will only log the output of the command, but it won't start
  ;; because the command doesn't exist.
  ignore-failure-cmd (cmd-log info none thiscmddoesnotexist)

  verbose-only-log (cmd-log verbose verbose bash -c "echo yo")
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>There is a variant of <code>cmd</code>: <code>cmd-output-keys</code>. This variant reads the output
of the executed program and reads it as an S-expression, similarly to the
<a href="#macro">macro action</a>. However â€” unlike macro â€” only delays, keys, chords, and
chorded lists are supported. Other actions are not supported.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>(defalias
  ;; bash: type date-time as YYYY-MM-DD HH:MM
  pdb (cmd-output-keys bash -c "date +'%F %R' | sed 's/./&amp; /g' | sed 's/:/S-;/g' | sed 's/\(.\{20\}\)\(.*\)/\(\1 spc \2\)/'")

  ;; powershell: type date-time as YYYY-MM-DD HH:MM
  pdp (cmd-output-keys powershell.exe "echo '(' (((Get-Date -Format 'yyyy-MM-dd HH:mm').toCharArray() -join ' ').insert(20, ' spc ') -replace ':','S-;') ')'")
)</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="arbitrary-code">arbitrary-code</h3>
<div class="paragraph">
<p>The <code>arbitrary-code</code> action allows sending an arbitrary number to kanata&#8217;s
output mechanism. The press is sent when pressed, and the release sent when
released. This action can be useful for testing keys that are not yet named or
mapped in kanata. Please contribute findings with names and mappings, either in
a GitHub issue or as a pull request!</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
This is not cross platform!
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
When using the Interception driver, this action is still sent over
SendInput.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>(defalias ab1 (arbitrary-code 700))</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="global-overrides">Global overrides</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>defoverrides</code> optional configuration item allows you to create global
key overrides, irrespective of what actions are used to generate those keys.
It accepts pairs of lists:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>the input key list that gets replaced</p>
</li>
<li>
<p>the output key list to replace the input keys with</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Both input and output lists accept 0 or more modifier keys (e.g. lctl, rsft)
and exactly 1 non-modifier key (e.g. 1, bspc).</p>
</div>
<div class="paragraph">
<p>Only zero or one <code>defoverrides</code> is allowed in a configuration file.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Depending on your use case
you may want to adjust <a href="#override-release-on-activation">override-release-on-activation</a> in <code>defcfg</code>.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Example:</div>
<div class="content">
<pre class="highlight"><code>;; Swap numbers and their symbols with respect to shift
(defoverrides
  (1) (lsft 1)
  (2) (lsft 2)
  ;; repeat for all remaining numbers

  (lsft 1) (1)
  (lsft 2) (2)
  ;; repeat for all remaining numbers
)</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_include_other_files">Include other files<a id="include"></a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>include</code> optional configuration item
allows you to include other files into the configuration.
This configuration accepts a single string which is a file path.
The file path can be an absolute path or a relative path.
The path will be relative to the defined configuration file.</p>
</div>
<div class="paragraph">
<p>At the time of writing, includes can only be placed at the top level.
The included files also cannot contain includes themselves.</p>
</div>
<div class="paragraph">
<p>Non-existing files will be ignored.</p>
</div>
<div class="listingblock">
<div class="title">Example:</div>
<div class="content">
<pre>;; This is in the file initially read by kanata, e.g. kanata.kbd
(include other-file.kbd)

;; This is in the other file
(defalias
  included-alias XX
  ;; ...
)

;; This is in the other file
(deflayer included-layer
  ;; ...
)</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="platform">Platform-specific configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you put any top-level configuration item
within a list beginning with <code>platform</code>,
it will become a platform-specific configuration
that is only active for the specified platforms.</p>
</div>
<div class="listingblock">
<div class="title">Syntax:</div>
<div class="content">
<pre class="highlight"><code>(platform (applicable-platforms) ...)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The valid values for applicable platforms are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>win</code></p>
</li>
<li>
<p><code>winiov2</code></p>
</li>
<li>
<p><code>wintercept</code></p>
</li>
<li>
<p><code>linux</code></p>
</li>
<li>
<p><code>macos</code></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Example:</div>
<div class="content">
<pre class="highlight"><code>(platform (macos)
  ;; Only on macos, use command arrows to jump/delete words
  ;; because command is used for so many other things
  ;; and it's weird that these cases use alt.
  (defoverrides
    (lmet bspc) (lalt bspc)
    (lmet left) (lalt left)
    (lmet right) (lalt right)
  )
)

(platform (win winiov2 wintercept)
  (defalias run-my-script (cmd #| something involving powershell |#))
)

(platform (macos linux)
  (defalias run-my-script (cmd #| something involving bash |#))
)</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="environment">Environment-conditional configuration</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="title">Syntax:</div>
<div class="content">
<pre class="highlight"><code>(environment (env-var-name env-var-value) ...)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The items <code>env-var-name</code> and <code>env-var-value</code> can be arbitrary strings.
The name is the environment variable that is read
for determining if the configuration is used or not.
If the value of the environment variable (set only on kanata startup)
matches <code>env-var-value</code>, the configuration is used; otherwise it is ignored.
An empty string for <code>env-var-value</code> â€” <code>""</code> â€” will use the configuration
if the environment variable an empty string
and also if the variable is unset/missing entirely.</p>
</div>
<div class="listingblock">
<div class="title">Example:</div>
<div class="content">
<pre class="highlight"><code>(environment (LAPTOP lp1)
  (defalias met @lp1met)
)

(environment (LAPTOP lp2)
  (defalias met @lp2met)
)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Set environment variables in the current terminal process:</div>
<div class="content">
<pre class="highlight"><code># powershell
$env:VAR_NAME = "var_value"

# bash
VAR_NAME=var_value</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="input-chords-v2">Input chords / combos (v2)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You may define a single <code>defchordsv2</code> configuration item.
This enables you to define global input chord behaviour.
One might also find this functionality called another name of "combos"
in other projects.</p>
</div>
<div class="paragraph">
<p>Input chords enables you to press two or more keys in quick succession
to activate a different action
than would normally be associated with those keys.
When activating a chord, the order of presses is not important;
when all keys belonging to a chord are pressed,
the action activates regardless of press order.</p>
</div>
<div class="paragraph">
<p>The <code>defchordsv2</code> feature is configured as shown below:</p>
</div>
<div class="listingblock">
<div class="title">Syntax example</div>
<div class="content">
<pre class="highlight"><code>(defchordsv2
  (participating-keys1) action1 timeout1 release-behaviour1 (disabled-layers1)
    ...
  (participating-keysN) actionN timeoutN release-behaviourN (disabled-layersN)
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The configuration is made up of 5-tuples of:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$participating-keys</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">These are key names you would use in <code>defsrc</code>.
A minimum of two keys must be defined per chord.
The list must be unique per chord.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$action</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">These are actions as you would configure in <code>deflayer</code> or <code>defalias</code>.
The action activates if all participating keys are activated
within the timeout.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$timeout</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The time (unit: milliseconds) within which,
if all participating keys are pressed,
the chord action will activate;
otherwise the key presses are handled by the active layer.
The time begins when the first participant is pressed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$release-behaviour</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This must be either <code>first-release</code> or <code>all-released</code>;
<code>first-release</code> means the chord action will be released
when the first participant is released,
while <code>all-released</code> means the chord action will be released
only when all of the participants have been released.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$disabled-layers</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A list of layer names on which this chord is disabled.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Input chords have a related <code>defcfg</code> item: <a href="#chords-v2-min-idle">chords-v2-min-idle</a>.
When any non-chord activation happens,
a timeout begins with duration configured by
<code>chords-v2-min-idle</code> (unit: milliseconds).
Until this timeout expires, all inputs will immediately skip
chords processing and be processed by the active layer.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
When opting into input chords v2,
you must enable <code>concurrent-tap-hold</code>.
This is enforced for a more responsive <code>tap-hold</code> experience when
activated by a chord.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Example:</div>
<div class="content">
<pre class="highlight"><code>(defcfg concurrent-tap-hold yes)
(defchordsv2
  (a s)    c                200 all-released  (non-chord-layer)
  (a s d) (macro h e l l o) 250 first-release (non-chord-layer)
  (s d f) (macro b y e)     400 first-release (non-chord-layer)
)</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Also see <a href="#input-chords">v1 chords</a>,
which are configured differently and can be defined per-layer.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="optional-defcfg-options">defcfg options</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="danger-enable-cmd">danger-enable-cmd</h3>
<div class="paragraph">
<p>This option can be used to enable the <code>cmd</code> action in your configuration. The
<code>cmd</code> action allows kanata to execute programs with arguments passed to them.</p>
</div>
<div class="paragraph">
<p>This requires using a kanata program that is compiled with the <code>cmd</code> action
enabled. The reason for this is so that if you choose to, there is no way for
kanata to execute arbitrary programs even if you download some random
configuration from the internet.</p>
</div>
<div class="paragraph">
<p>This configuration is disabled by default and can be enabled by giving it the
value <code>yes</code>.</p>
</div>
<div class="listingblock">
<div class="title">Example:</div>
<div class="content">
<pre class="highlight"><code>(defcfg
  danger-enable-cmd yes
)</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sequence-timeout">sequence-timeout</h3>
<div class="paragraph">
<p>This option customizes the key sequence timeout (unit: ms). Its default value
is 1000. The purpose of this item is explained in <a href="#sequences">Sequences</a>.</p>
</div>
<div class="listingblock">
<div class="title">Example:</div>
<div class="content">
<pre class="highlight"><code>(defcfg
  sequence-timeout 2000
)</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sequence-input-mode">sequence-input-mode</h3>
<div class="paragraph">
<p>This option customizes the key sequence input mode. Its default value when not
configured is <code>hidden-suppressed</code>.</p>
</div>
<div class="paragraph">
<p>The options are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>visible-backspaced</code>: types sequence characters as they are inputted. The
typed characters will be erased with backspaces for a valid sequence termination.</p>
</li>
<li>
<p><code>hidden-suppressed</code>: hides sequence characters as they are typed. Does not
output the hidden characters for an invalid sequence termination.</p>
</li>
<li>
<p><code>hidden-delay-type</code>: hides sequence characters as they are typed. Outputs the
hidden characters for an invalid sequence termination either after a
timeout or after a non-sequence key is typed.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For <code>visible-backspaced</code> and <code>hidden-delay-type</code>, a sequence leader input will
be ignored if a sequence is already active. For historical reasons, and in case
it is desired behaviour, a sequence leader input using <code>hidden-suppressed</code> will
reset the key sequence.</p>
</div>
<div class="paragraph">
<p>See <a href="#sequences">Sequences</a> for more about sequences.</p>
</div>
<div class="listingblock">
<div class="title">Example:</div>
<div class="content">
<pre class="highlight"><code>(defcfg
  sequence-input-mode visible-backspaced
)</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sequence-backtrack-modcancel">sequence-backtrack-modcancel</h3>
<div class="paragraph">
<p>This option customizes the behaviour of key sequences
when modifiers are used.
The default is <code>yes</code> and can be overridden to <code>no</code> if desired.</p>
</div>
<div class="paragraph">
<p>Setting it to <code>yes</code> allows both <code>fk1</code> and <code>fk2</code> to be activated
in the following configuration, but with <code>no</code>,
<code>fk1</code> will be impossible to activate</p>
</div>
<div class="listingblock">
<div class="content">
<pre>(defseq
  fk1 (lsft a b)
  fk2 (S-(c d))
)</pre>
</div>
</div>
<div class="paragraph">
<p>See <a href="#sequences">Sequences</a> for more about sequences and
<a href="https://github.com/jtroo/kanata/blob/main/docs/sequence-adding-chords-ideas.md">this document</a>
for more context about this specific configuration.</p>
</div>
<div class="listingblock">
<div class="title">Example:</div>
<div class="content">
<pre class="highlight"><code>(defcfg
  sequence-backtrack-modcancel no
)</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="log-layer-changes">log-layer-changes</h3>
<div class="paragraph">
<p>By default, kanata will log layer changes. However, logging has some processing
overhead. If you do not care for the logging, you can choose to disable it.</p>
</div>
<div class="listingblock">
<div class="title">Example:</div>
<div class="content">
<pre class="highlight"><code>(defcfg
  log-layer-changes no
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>If <code>--log-layer-changes</code> is passed as a command line argument,
a <code>no</code> in the configuration file will be overridden
and layer changes will again be logged.
This flag can be helpful when testing new configuration changes
while keeping the default behaviour as "no logging" to save on processing,
so that the <code>defcfg</code> item does not need to be adjusted back and forth
when experimenting vs. stable usage.</p>
</div>
</div>
<div class="sect2">
<h3 id="delegate-to-first-layer">delegate-to-first-layer</h3>
<div class="paragraph">
<p>By default, transparent keys on layers
will delegate to the corresponding defsrc key
when found on a layer activated by <code>layer-switch</code>.</p>
</div>
<div class="paragraph">
<p>This config entry changes the behaviour
to delegate to the action in the same position on the first layer defined
in the configuration, which is the active layer on startup.</p>
</div>
<div class="paragraph">
<p>For more context, see <a href="https://github.com/jtroo/kanata/issues/435" class="bare">https://github.com/jtroo/kanata/issues/435</a>.</p>
</div>
<div class="listingblock">
<div class="title">Example:</div>
<div class="content">
<pre class="highlight"><code>(defcfg
  delegate-to-first-layer yes
)</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="movemouse-inherit-accel-state">movemouse-inherit-accel-state</h3>
<div class="paragraph">
<p>By default <code>movemouse-accel</code> actions will track the acceleration
state for vertical and horizontal axes separately.</p>
</div>
<div class="paragraph">
<p>When this setting is enabled, <code>movemouse-accel</code> will behave exactly like mouse movements in <a href="https://qmk.fm">QMK</a>,
i.e. the acceleration state of new mouse
movement actions will be inherited if others are already being pressed.</p>
</div>
<div class="listingblock">
<div class="title">Example:</div>
<div class="content">
<pre class="highlight"><code>(defcfg
  movemouse-inherit-accel-state yes
)</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="movemouse-smooth-diagonals">movemouse-smooth-diagonals</h3>
<div class="paragraph">
<p>By default, mouse movements move one direction at a time
and vertical/horizontal movements are on independent timers.</p>
</div>
<div class="paragraph">
<p>This can result in non-smooth diagonals when drawing a line in some app.
This option adds a small imperceptible amount of latency to
synchronize the mouse movements.</p>
</div>
<div class="listingblock">
<div class="title">Example:</div>
<div class="content">
<pre class="highlight"><code>(defcfg
  movemouse-smooth-diagonals yes
)</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="dynamic-macro-max-presses">dynamic-macro-max-presses</h3>
<div class="paragraph">
<p>This configuration allows you to customize the length limit on dynamic macros.
The default length limit is 128 keys.</p>
</div>
<div class="listingblock">
<div class="title">Example:</div>
<div class="content">
<pre class="highlight"><code>(defcfg
  dynamic-macro-max-presses 1000
)</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="concurrent-tap-hold">concurrent-tap-hold</h3>
<div class="paragraph">
<p>This configuration makes multiple tap-hold actions
that are activated near in time expire their timeout quicker.
By default this is disabled.
When disabled, the timeout for a following tap-hold
will start from 0ms <strong>after</strong> the previous tap-hold expires.
When enabled, the timeout will start
as soon as the tap-hold action is pressed
even if a previous tap-hold action is still held and has not expired.</p>
</div>
<div class="listingblock">
<div class="title">Example:</div>
<div class="content">
<pre class="highlight"><code>(defcfg
  concurrent-tap-hold yes
)</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="block-unmapped-keys">block-unmapped-keys</h3>
<div class="paragraph">
<p>If you desire to use only a subset of your keyboard
you can use <code>block-unmapped-keys</code> to make every key
other than those that exist in <code>defsrc</code> a no-op.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
this only functions correctly if you also set
<a href="#process-unmapped-keys">process-unmapped-keys</a> to yes.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Example:</div>
<div class="content">
<pre class="highlight"><code>(defcfg
  block-unmapped-keys yes
)</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="rapid-event-delay">rapid-event-delay</h3>
<div class="paragraph">
<p>This configuration applies to the following events:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the release of one-shot-press activation</p>
</li>
<li>
<p>the release of the tapped key in a tap-hold activation</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These events are delayed the defined number of milliseconds (approximate).
The default value is 5.</p>
</div>
<div class="paragraph">
<p>While the release is delayed, further processing of inputs is also paused.
This means that there will be a minor input latency impact in the mentioned scenarios.
Since 5ms is 1 frame for a 200 Hz refresh rate,
in most scenarios this will not be perceptible.</p>
</div>
<div class="paragraph">
<p>The reason for this configuration existing is that some environments
do not process the scenarios correctly due to the rapidity of the release.
Kanata does send the events in the correct order,
so the fault is more in the environment,
but kanata provides a workaround anyway.</p>
</div>
<div class="paragraph">
<p>If you are negatively impacted by the latency increase of these events
and your environment is not impacted by increased rapidity,
you can set reduce the value to a number 0 to 4.</p>
</div>
<div class="listingblock">
<div class="title">Example:</div>
<div class="content">
<pre class="highlight"><code>(defcfg
  ;; If your environment is particularly buggy, might need to delay even more
  rapid-event-delay 20
)</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="chords-v2-min-idle">chords-v2-min-idle</h3>
<div class="paragraph">
<p>This configuration affects the timer during which chords processing is disabled.
NOTE: For more info, see <a href="#input-chords-v2">Input chords / combos (v2)</a>.</p>
</div>
<div class="paragraph">
<p>The default (and minimum) value is <code>5</code> and the unit is milliseconds.</p>
</div>
<div class="listingblock">
<div class="title">Example:</div>
<div class="content">
<pre class="highlight"><code>(defcfg
  chords-v2-min-idle 200
)</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="override-release-on-activation">override-release-on-activation</h3>
<div class="paragraph">
<p>This configuration item changes activation behaviour from <code>defoverrides</code>.</p>
</div>
<div class="paragraph">
<p>Take this example override:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>(defoverrides (lsft a) (lsft 9))</code></pre>
</div>
</div>
<div class="paragraph">
<p>The default behaviour is that if <code>lsft</code> is released <strong>before</strong> releasing <code>a</code>,
kanata&#8217;s behaviour would be to send <code>a</code>.</p>
</div>
<div class="paragraph">
<p>A future improvement could be to make the <code>9</code> continue to be the key held,
but that is not implemented today.</p>
</div>
<div class="paragraph">
<p>The workaround in case the above behaviour negatively impacts your workflow
is to enable this configuration.
This configuration will press and then immediately release the <code>9</code> output
as soon as the override activates, meaning you are unlikely as a human to ever
release <code>lsft</code> first.</p>
</div>
<div class="paragraph">
<p>The effect of this configuration is that the <code>9</code> key cannot remain held
when activated by the override which is important to consider for your use cases.</p>
</div>
<div class="listingblock">
<div class="title">Example:</div>
<div class="content">
<pre class="highlight"><code>(defcfg
  override-release-on-activation yes
)</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="allow-hardware-repeat">allow-hardware-repeat</h3>
<div class="paragraph">
<p>By default, any repeat-key events generated by the physical keyboard (or operating system)
will be passed through to the application.  On Linux, under Wayland, this is wasted effort
since the DE handles key-repeat on its own.  Such events can also be distracting when
debugging your configuration with evtest, etc.</p>
</div>
<div class="paragraph">
<p>Setting this option to "false" will cause such events to be dropped, and not passed through.
This is primarily meant for Linux, but may find some use on Mac.  It is not implemented on
Windows, and will be silently ignored.</p>
</div>
<div class="listingblock">
<div class="title">Example:</div>
<div class="content">
<pre class="highlight"><code>(defcfg
   allow-hardware-repeat false
)</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="alias-to-trigger-on-load">alias-to-trigger-on-load</h3>
<div class="paragraph">
<p>Select an alias to execute when first starting, and after each
live-reload of the config. You can use this to run external
commands, or to stack layers (with layer-while-held).</p>
</div>
<div class="paragraph">
<p>The name of an alias, without a leading "@", is expected as a
parameter.  The example below will beep at startup (assuming
your system has a beep command), and will already be blocking
the swapped "i" and "o" keys.</p>
</div>
<div class="listingblock">
<div class="title">Example:</div>
<div class="content">
<pre class="highlight"><code>(defcfg
  alias-to-trigger-on-load S
  danger-enable-cmd yes
)

(deffakekeys B (layer-while-held block))

(defalias
  P (on-press toggle-vkey B)
  S (macro @P (cmd beep))
)

(defsrc i o p )
(deflayer base o i @P )
(deflayer block â€¢ â€¢ _ )</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="linux-only-linux-dev">Linux only: linux-dev</h3>
<div class="paragraph">
<p>By default, kanata will try to detect which input devices are keyboards and try
to intercept them all. However, you may specify exact keyboard devices from the
<code>/dev/input</code> directories using the <code>linux-dev</code> configuration.</p>
</div>
<div class="listingblock">
<div class="title">Example:</div>
<div class="content">
<pre class="highlight"><code>(defcfg
  linux-dev /dev/input/by-path/platform-i8042-serio-0-event-kbd
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you want to specify multiple keyboards, you can separate the paths with a
colon <code>:</code>.</p>
</div>
<div class="listingblock">
<div class="title">Example:</div>
<div class="content">
<pre class="highlight"><code>(defcfg
  linux-dev /dev/input/dev1:/dev/input/dev2
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Due to using the colon to separate devices, if you have a device with colons in
its file name, you must escape those colons with backslashes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>(defcfg
  linux-dev /dev/input/path-to\:device
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, you can use list syntax, where both backslashes and colons
are parsed literally. List items are separated by spaces or newlines.
Using quotation marks for each item is optional, and only required if an
item contains spaces.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>(defcfg
  linux-dev (
    /dev/input/path:to:device
    "/dev/input/path to device"
  )
)</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="linux-only-linux-dev-names-include">Linux only: linux-dev-names-include</h3>
<div class="paragraph">
<p>In the case that <code>linux-dev</code> is omitted,
this option defines a list of device names that should be included.
Device names that do not exist in the list will be ignored.
This option is parsed identically to <code>linux-dev</code>.</p>
</div>
<div class="paragraph">
<p>Kanata will print device names on startup with log lines that look like below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>registering /dev/input/eventX: "Name goes here"</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example:</div>
<div class="content">
<pre class="highlight"><code>(defcfg
  linux-dev-names-include (
    "Device name 1"
    "Device name 2"
  )
)</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="linux-only-linux-dev-names-exclude">Linux only: linux-dev-names-exclude</h3>
<div class="paragraph">
<p>In the case that <code>linux-dev</code> is omitted,
this option defines a list of device names that should be excluded.
This option is parsed identically to <code>linux-dev</code>.</p>
</div>
<div class="paragraph">
<p>The <code>linux-dev-names-include</code> and <code>linux-dev-names-exclude</code> options
are not mutually exclusive
but in practice it probably only makes sense to use one and not both.</p>
</div>
<div class="listingblock">
<div class="title">Example:</div>
<div class="content">
<pre class="highlight"><code>(defcfg
  linux-dev-names-exclude (
    "Device Name 1"
    "Device Name 2"
  )
)</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="linux-only-linux-continue-if-no-devs-found">Linux only: linux-continue-if-no-devs-found</h3>
<div class="paragraph">
<p>By default, kanata will crash if no input devices are found. You can change
this behaviour by setting <code>linux-continue-if-no-devs-found</code>.</p>
</div>
<div class="listingblock">
<div class="title">Example:</div>
<div class="content">
<pre class="highlight"><code>(defcfg
  linux-continue-if-no-devs-found yes
)</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="linux-only-linux-device-detect-mode">Linux only: linux-device-detect-mode</h3>
<div class="paragraph">
<p>Kanata on Linux automatically detects and grabs input devices
when none of the explicit device configurations are in use.
In case kanata is undesirably grabbing mouse-like devices,
you can use a configuration item to change detection behaviour.</p>
</div>
<div class="paragraph">
<p>The configuration is <code>linux-device-detect-mode</code> and it has the options:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>keyboard-only</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Grab devices that seem to be a keyboard only.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>keyboard-mice</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Grab devices that seem to be a keyboard only
and devices that declare <strong>both</strong> keyboard and mouse functionality.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>any</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Grab all keyboard-like and mouse-like devices.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The default behaviour is:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>keyboard-mice</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When no mouse events are in <code>defsrc</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>any</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When any mouse buttons or mouse scroll events are in <code>defsrc</code>.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="linux-only-linux-unicode-u-code">Linux only: linux-unicode-u-code</h3>
<div class="paragraph">
<p>Unicode on Linux works by pressing Ctrl+Shift+U, typing the unicode hex value,
then pressing Enter. However, if you do remapping in userspace, e.g. via
xmodmap/xkb, the keycode "U" that kanata outputs may not become a keysym "u"
after the userspace remapping. This will be likely if you use non-US,
non-European keyboards on top of kanata. For unicode to work, kanata needs to
use the keycode that outputs the keysym "u", which might not be the keycode
"U".</p>
</div>
<div class="paragraph">
<p>You can use <code>evtest</code> or <code>kanata --debug</code>, set your userspace key remapping,
then press the key that outputs the keysym "u" to see which underlying keycode
is sent. Then you can use this configuration to change kanata&#8217;s behaviour.</p>
</div>
<div class="listingblock">
<div class="title">Example:</div>
<div class="content">
<pre class="highlight"><code>(defcfg
  linux-unicode-u-code v
)</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="linux-only-linux-unicode-termination">Linux only: linux-unicode-termination</h3>
<div class="paragraph">
<p>Unicode on Linux terminates with the Enter key by default. This may not work in
some applications. The termination is configurable with the following options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>enter</code></p>
</li>
<li>
<p><code>space</code></p>
</li>
<li>
<p><code>enter-space</code></p>
</li>
<li>
<p><code>space-enter</code></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Example:</div>
<div class="content">
<pre class="highlight"><code>(defcfg
  linux-unicode-termination space
)</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_linux_only_linux_x11_repeat_delay_rate">Linux only: linux-x11-repeat-delay-rate<a id="linux-only-x11-repeat-rate"></a></h3>
<div class="paragraph">
<p>On Linux, you can tell kanata to run <code>xset r rate &lt;delay&gt; &lt;rate&gt;</code>
on startup and on live reload
via the configuration item <code>linux-only-x11-repeat-rate</code>.
This takes two numbers separated by a comma.
The first number is the delay in ms
and the second number is the repeat rate in repeats/second.</p>
</div>
<div class="paragraph">
<p>This configuration item does not affect Wayland or no-desktop environments.</p>
</div>
<div class="listingblock">
<div class="title">Example:</div>
<div class="content">
<pre class="highlight"><code>(defcfg
  linux-x11-repeat-delay-rate 400,50
)</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="linux-only-linux-use-trackpoint-property">Linux only: linux-use-trackpoint-property</h3>
<div class="paragraph">
<p>On linux, you can ask kanata to label itself as a trackpoint. This has several
effects on libinput including enabling middle mouse button scrolling and using a
different acceleration curve. Otherwise, a trackpoint intercepted by kanata may
not behave as expected.</p>
</div>
<div class="paragraph">
<p>If using this feature, it is recommended to filter out any non-trackpoint
pointing devices using <a href="#linux-only-linux-dev-names-include">Linux only: linux-dev-names-include</a>,
<a href="#linux-only-linux-dev-names-exclude">Linux only: linux-dev-names-exclude</a> or <a href="#linux-only-linux-dev">Linux only: linux-dev</a> to avoid
changing their behavior as well.</p>
</div>
<div class="listingblock">
<div class="title">Example:</div>
<div class="content">
<pre class="highlight"><code>(defcfg
  linux-use-trackpoint-property yes
)</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="linux-only-linux-output-device-bus-type">Linux only: linux-output-device-bus-type</h3>
<div class="paragraph">
<p>Kanata on Linux needs to declare a "bus type" for its evdev output device.
The options are <code>USB</code> and <code>I8042</code>, with the default as <code>I8042</code>.
Using USB can <a href="https://github.com/jtroo/kanata/pull/661">break disable-touchpad-while-typing on Wayland</a>.
But using I8042 appears to break <a href="https://github.com/jtroo/kanata/issues/1131">some other scenarios</a>.
Thus the output bus type is configurable.</p>
</div>
<div class="listingblock">
<div class="title">Example:</div>
<div class="content">
<pre class="highlight"><code>(defcfg
   linux-output-device-bus-type USB
)</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="macos-only-macos-dev-names-include">macOS only: macos-dev-names-include</h3>
<div class="paragraph">
<p>This option defines a list of device names that should be included.
By default, kanata will try to detect which input devices are keyboards and try
to intercept them all. However, you may specify exact keyboard devices to intercept
using the <code>macos-dev-names-include</code> configuration.
Device names that do not exist in the list will be ignored.
This option is parsed identically to <code>linux-dev</code>.</p>
</div>
<div class="paragraph">
<p>Use <code>kanata -l</code> or <code>kanata --list</code> to list the available keyboards.</p>
</div>
<div class="listingblock">
<div class="title">Example:</div>
<div class="content">
<pre class="highlight"><code>(defcfg
  macos-dev-names-include (
    "Device name 1"
    "Device name 2"
  )
)</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="windows-only-windows-altgr">Windows only: windows-altgr</h3>
<div class="paragraph">
<p>There is an option for Windows to mitigate the strange behaviour of AltGr (ralt)
if you&#8217;re using <code>process-unmapped-keys yes</code> or have the key in your defsrc.
This is applicable for many non-US layouts.
You can use one of the listed values to change what kanata does with the key:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>cancel-lctl-press</code></p>
<div class="ulist">
<ul>
<li>
<p>This will remove the <code>lctl</code> press that is generated alonside <code>ralt</code></p>
</li>
</ul>
</div>
</li>
<li>
<p><code>add-lctl-release</code></p>
<div class="ulist">
<ul>
<li>
<p>This adds an <code>lctl</code> release when <code>ralt</code> is released</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Without these workarounds,
you should instead ensure you set <code>process-unmapped-keys no</code>
<strong>and</strong> also omit both <code>ralt</code> and <code>lctl</code> from <code>defsrc</code>.</p>
</div>
<div class="listingblock">
<div class="title">Example:</div>
<div class="content">
<pre class="highlight"><code>(defcfg
  windows-altgr add-lctl-release
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more context, see: <a href="https://github.com/jtroo/kanata/issues/55" class="bare">https://github.com/jtroo/kanata/issues/55</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Even with these workarounds, putting <code>lctl</code> and <code>ralt</code> in your defsrc may not
work properly with other applications that also use keyboard interception.
Known application with issues: GWSL/VcXsrv
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_windows_only_windows_interception_mouse_hwid">Windows only: windows-interception-mouse-hwid<a id="windows-only-windows-interception-mouse-hwid"></a></h3>
<div class="paragraph">
<p>This defcfg item allows you to intercept mouse buttons for a specific mouse device.
This only works with the Interception driver
(the -wintercept variants of the release binaries).</p>
</div>
<div class="paragraph">
<p>The original use case for this is for laptops such as a Thinkpad,
which have mouse buttons that may be desirable to activate kanata actions with.</p>
</div>
<div class="paragraph">
<p>To know what numbers to put into the string, you can run the variant with this
defcfg item defined with any numbers. Then when a button is first pressed on
the mouse device, kanata will print its hwid in the log; you can then
copy-paste that into this configuration entry. If this defcfg item is not
defined, the log will not print.</p>
</div>
<div class="paragraph">
<p>Hwids in Kanata are byte array representations of a concatenation of the
ASCII hardware ids, which can be seen in Device Manager on Windows. As such,
they are an arbitrary length and can be very long.</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/jtroo/kanata/issues/108">Relevant issue</a>.</p>
</div>
<div class="listingblock">
<div class="title">Example:</div>
<div class="content">
<pre class="highlight"><code>(defcfg
  windows-interception-mouse-hwid "70, 0, 60, 0"
)</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_windows_only_windows_interception_mouse_hwids">Windows only: windows-interception-mouse-hwids<a id="windows-only-windows-interception-mouse-hwids"></a></h3>
<div class="paragraph">
<p>This item has a similar purpose as the singular version documented above,
but is instead a list of strings that allows multiple mice to be intercepted.</p>
</div>
<div class="paragraph">
<p>If both the singular and list items are used,
the singular version will behave as if added to the list.</p>
</div>
<div class="listingblock">
<div class="title">Example:</div>
<div class="content">
<pre class="highlight"><code>(defcfg
  windows-interception-mouse-hwids (
    "70, 0, 60, 0"
    "71, 0, 62, 0"
  )
)</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_windows_only_windows_interception_keyboard_hwids">Windows only: windows-interception-keyboard-hwids<a id="windows-only-windows-interception-keyboard-hwids"></a></h3>
<div class="paragraph">
<p>This defcfg item allows you to intercept only specific keyboards.
Its value must be a list of strings
with each string representing one hardware ID.</p>
</div>
<div class="paragraph">
<p>To know what numbers to put into the string,
you can run the variant with this defcfg item empty.
Then when a button is first pressed on the keyboard,
kanata will print its hwid in the log.
You can then copy-paste that into this configuration entry.
If this defcfg item is not defined, the log will not print.</p>
</div>
<div class="paragraph">
<p>Hwids in Kanata are byte array representations of a concatenation of the
ASCII hardware ids, which can be seen in Device Manager on Windows. As such,
they are an arbitrary length and can be very long.</p>
</div>
<div class="listingblock">
<div class="title">Example:</div>
<div class="content">
<pre class="highlight"><code>(defcfg
  windows-interception-keyboard-hwids (
    "70, 0, 60, 0"
    "71, 72, 73, 74"
  )
)</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="windows-only-tray-icon">Windows only: tray-icon</h3>
<div class="paragraph">
<p>Show a custom tray icon file for a <a href="#windows-only-win-tray">Windows only: win-tray</a> gui-enabled build of kanata on Windows.
Accepts either the full path (including the file name with an extension) to the icon file
or just the file name, which is then searched in the following locations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Default parent folders:</p>
<div class="ulist">
<ul>
<li>
<p>config file&#8217;s, executable&#8217;s</p>
</li>
<li>
<p>env vars: <code>XDG_CONFIG_HOME</code>, <code>APPDATA</code> (<code>C:\Users\&lt;Name&gt;\AppData\Roaming</code>), <code>USERPROFILE</code> <code>/.config</code> (<code>C:\Users\&lt;Name&gt;\.config</code>)</p>
</li>
</ul>
</div>
</li>
<li>
<p>Default config subfolders: <code>kanata</code> <code>kanata-tray</code></p>
</li>
<li>
<p>Default image subfolders (optional): <code>icon</code> <code>img</code> <code>icons</code></p>
</li>
<li>
<p>Supported image file formats: <code>ico</code> <code>jpg</code> <code>jpeg</code> <code>png</code> <code>bmp</code> <code>dds</code> <code>tiff</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If not specified, tries to load any icon file from the same locations with the name matching
config name with extension replaced by one of the supported ones.
See <a href="https://github.com/jtroo/kanata/blob/main/cfg_samples/tray-icon/tray-icon.kbd">example config</a> for more details.</p>
</div>
<div class="listingblock">
<div class="title">Example:</div>
<div class="content">
<pre class="highlight"><code>;; in a config file C:\Users\&lt;U&gt;\AppData\Roaming\kanata\kanata.kbd
(defcfg
  tray-icon base.png ;; will load C:\Users\&lt;U&gt;\AppData\Roaming\kanata\base.png
)</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="windows-only-icon-match-layer-name">Windows only: icon-match-layer-name</h3>
<div class="paragraph">
<p>When enabled, attempt to switch to a custom tray icon that matches the name of the active layer
if the layer doesn&#8217;t specify an explicit icon. If no icon file is found, the default icon will be used (see <a href="#windows-only-tray-icon">Windows only: tray-icon</a>).
File search rules are the same as in <a href="#windows-only-tray-icon">Windows only: tray-icon</a>. Defaults to true.
See <a href="https://github.com/jtroo/kanata/blob/main/cfg_samples/tray-icon/tray-icon.kbd">example config</a> for more details.</p>
</div>
</div>
<div class="sect2">
<h3 id="windows-only-tooltip-layer-changes">Windows only: tooltip-layer-changes</h3>
<div class="paragraph">
<p>Show a custom layer icon near the mouse pointer position. Defaults to false. Requires <a href="#windows-only-win-tray">Windows only: win-tray</a> gui-enabled build.</p>
</div>
</div>
<div class="sect2">
<h3 id="windows-only-tooltip-show-blank">Windows only: tooltip-show-blank</h3>
<div class="paragraph">
<p>Show a blank square when instead of an icon if a layer isn&#8217;t configured to have one. Defaults to false. Requires <a href="#windows-only-win-tray">Windows only: win-tray</a> gui-enabled build.</p>
</div>
</div>
<div class="sect2">
<h3 id="windows-only-tooltip-no-base">Windows only: tooltip-no-base</h3>
<div class="paragraph">
<p>Don&#8217;t show a tooltip layer icon for the base layer (1st deflayer). Defaults to true. Requires <a href="#windows-only-win-tray">Windows only: win-tray</a> gui-enabled build.</p>
</div>
</div>
<div class="sect2">
<h3 id="windows-only-tooltip-duration">Windows only: tooltip-duration</h3>
<div class="paragraph">
<p>Set duration (in ms) for showing a custom layer icon near the mouse pointer position. 0 to never hide. Defaults to 500. Requires <a href="#windows-only-win-tray">Windows only: win-tray</a> gui-enabled build.</p>
</div>
</div>
<div class="sect2">
<h3 id="windows-only-tooltip-size">Windows only: tooltip-size</h3>
<div class="paragraph">
<p>Set the size (comma-separated Width,Height without spaces) for a custom layer icon near the mouse pointer position. Defaults to 24,24. Requires <a href="#windows-only-win-tray">Windows only: win-tray</a> gui-enabled build.</p>
</div>
</div>
<div class="sect2">
<h3 id="windows-only-notify-cfg-reload">Windows only: notify-cfg-reload</h3>
<div class="paragraph">
<p>Show system notification message on config reload. Defaults to true. Requires <a href="#windows-only-win-tray">Windows only: win-tray</a> gui-enabled build.</p>
</div>
</div>
<div class="sect2">
<h3 id="windows-only-notify-cfg-reload-silent">Windows only: notify-cfg-reload-silent</h3>
<div class="paragraph">
<p>Disable sound for the system notification message on config reload. Defaults to false. Requires <a href="#windows-only-win-tray">Windows only: win-tray</a> gui-enabled build.</p>
</div>
</div>
<div class="sect2">
<h3 id="windows-only-notify-error">Windows only: notify-error</h3>
<div class="paragraph">
<p>Show system notification message on kanata errors. Defaults to true. Requires <a href="#windows-only-win-tray">Windows only: win-tray</a> gui-enabled build.</p>
</div>
</div>
<div class="sect2">
<h3 id="using-multiple-defcfg-options">Using multiple defcfg options</h3>
<div class="paragraph">
<p>The <code>defcfg</code> entry is treated as a list with pairs of strings. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>(defcfg a 1 b 2)</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will be treated as configuration <code>a</code> having value <code>1</code> and configuration
<code>b</code> having value <code>2</code>.</p>
</div>
<div class="paragraph">
<p>An example defcfg containing many of the options is shown below. It should be
noted options that are Linux-only, Windows-only, or macOS-only will be ignored when used on
a non-applicable operating system.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>;; Don't actually use this exact configuration,
;; it's almost certainly not what you want.
(defcfg
  process-unmapped-keys yes
  danger-enable-cmd yes
  sequence-timeout 2000
  sequence-input-mode visible-backspaced
  sequence-backtrack-modcancel no
  log-layer-changes no
  delegate-to-first-layer yes
  movemouse-inherit-accel-state yes
  movemouse-smooth-diagonals yes
  dynamic-macro-max-presses 1000
  linux-dev (/dev/input/dev1 /dev/input/dev2)
  linux-dev-names-include ("Name 1" "Name 2")
  linux-dev-names-exclude ("Name 3" "Name 4")
  linux-continue-if-no-devs-found yes
  linux-unicode-u-code v
  linux-unicode-termination space
  linux-x11-repeat-delay-rate 400,50
  windows-altgr add-lctl-release
  windows-interception-mouse-hwid "70, 0, 60, 0"
)</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_advanced_features">Advanced features<a id="advanced-features"></a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="virtual-keys">Virtual keys</h3>
<div class="paragraph">
<p>You can define up to 767 virtual keys.
These keys are not directly mapped to any physical key presses or releases.
Virtual keys can be activated via special actions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>(on-press    &lt;action&gt; &lt;virtual key name&gt;)</code> or <code>onâ†“</code>:
Activate a virtual key action when pressing the associated input key.</p>
</li>
<li>
<p><code>(on-release  &lt;action&gt; &lt;virtual key name&gt;)</code> or <code>onâ†‘</code>:
Activate a virtual key action when releasing the associated input key.</p>
</li>
<li>
<p><code>(on-idle &lt;idle time&gt; &lt;action&gt; &lt;virtual key name&gt;)</code>:
Activate a virtual key action when kanata has been idle
for at least <code>idle time</code> milliseconds.</p>
</li>
<li>
<p><code>(hold-for-duration &lt;hold time&gt; &lt;virtual key name&gt;</code>):
Press a virtual key for <code>hold time</code> milliseconds.
If <code>hold-for-duration</code> retriggered on a virtual key before release,
the time will be reset with no additional press/release events.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>&lt;action&gt;</code> parameter can be one of:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>tap-virtualkey     | tap-vkey</code>:
Press and release the virtual key. If the key is already pressed, this only releases it.</p>
</li>
<li>
<p><code>press-virtualkey   | press-vkey</code>:
Press the virtual key. It will not be released until another action triggers a release or tap.
If the key is already pressed, this does nothing.</p>
</li>
<li>
<p><code>release-virtualkey | release-vkey</code>:
Release the virtual key. If it is not already pressed, this does nothing.</p>
</li>
<li>
<p><code>toggle-virtualkey  | toggle-vkey</code>:
Press the virtual key if it is not already pressed, otherwise release it.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A virtual key can be defined in a <code>defvirtualkeys</code> configuration entry.
Configuring this entry is similar to <code>defalias</code>,
but you cannot make use of aliases inside to shorten an action.
You can refer to previously defined virtual keys.</p>
</div>
<div class="paragraph">
<p>Expanding on the <code>on-idle</code> action some more,
the wording that "kanata" has been idle is important.
Even if the keyboard is idle, kanata may not yet be idle.
For example, if a long-running macro is playing,
or kanata is waiting for the timeout of actions such as <code>caps-word</code> or <code>tap-dance</code>,
kanata is not yet idle, and the tick count for the <code>&lt;idle time&gt;</code> parameter
will not yet be counting even if you no longer have any keyboard keys pressed.</p>
</div>
<div class="listingblock">
<div class="title">Example:</div>
<div class="content">
<pre class="highlight"><code>(defvirtualkeys
  ;; Define some virtual keys that perform modifier actions
  ctl lctl
  sft lsft
  met lmet
  alt lalt

  ;; A virtual key that toggles all modifier virtual keys above
  tal (multi
        (on-press toggle-virtualkey ctl)
        (on-press toggle-virtualkey sft)
        (on-press toggle-virtualkey met)
        (on-press toggle-virtualkey alt)
      )

  ;; Virtual key that activates a macro
  vkmacro (macro h e l l o spc w o r l d)
)

(defalias
  psf (on-press press-virtualkey   sft)
  rsf (on-press release-virtualkey sft)

  tal (on-press tap-vkey tal)
  mac (on-press tap-vkey vkmacro)

  isf (on-idle 1000 tap-vkey sft)
  hfd (hold-for-duration 1000 met)
)

(deflayer use-virtual-keys
  @psf @rsf @tal @mac a s d f @isf @hfd
)</code></pre>
</div>
</div>
<details>
<summary class="title">Older fake keys documentation</summary>
<div class="content">
<div class="paragraph">
<p>The older configuration style of fake keys are still supported
but the new style is preferred due to (hopefully) clearer naming.</p>
</div>
<div class="paragraph">
<p>Fake keys can be defined inside of <code>deffakekeys</code>.</p>
</div>
<div class="paragraph">
<p>The actions are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>(on-press-fakekey &lt;fake key name&gt; &lt;action&gt;)</code> or <code>onâ†“fakekey</code>: Activate a fake key
action when pressing the key mapped to this action.</p>
</li>
<li>
<p><code>(on-release-fakekey &lt;fake key name&gt; &lt;action&gt;)</code> or <code>onâ†‘fakekey</code>: Activate a fake key
action when releasing the key mapped to this action.</p>
</li>
<li>
<p><code>(on-idle-fakekey &lt;fake key name&gt; &lt;action&gt; &lt;idle time&gt;)</code>:
Activate a fake key action when kanata has been idle
for at least <code>idle time</code> milliseconds.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The aforementioned <code>&lt;key action&gt;</code> can be one of four values:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>press</code>: Press the fake key. It will not be released until another action
triggers a release or tap.</p>
</li>
<li>
<p><code>release</code>: Release the fake key. If it&#8217;s not already pressed, this does nothing.</p>
</li>
<li>
<p><code>tap</code>: Press and release the fake key. If it&#8217;s already pressed, this only releases it.</p>
</li>
<li>
<p><code>toggle</code>: Press the fake key if not already pressed, otherwise release it.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Example:</div>
<div class="content">
<pre class="highlight"><code>(deffakekeys
  ctl lctl
  sft lsft
  met lmet
  alt lalt

  ;; Press all modifiers
  pal (multi
        (on-press fakekey ctl press)
        (on-press-fakekey sft press)
        (on-press-fakekey met press)
        (on-press-fakekey alt press)
      )

  ;; Release all modifiers
  ral (multi
        (on-press-fakekey ctl release)
        (on-press-fakekey sft release)
        (on-press-fakekey met release)
        (on-press-fakekey alt release)
      )
)

(defalias
  psf (on-press-fakekey sft press)
  rsf (on-press-fakekey sft release)

  pal (on-press-fakekey pal tap)
  ral (on-press-fakekey ral tap)

  isf (on-idle-fakekey sft tap 1000)
)

(deflayer use-virtual-keys
  @psf @rsf @pal @ral a s d f @isf
)</code></pre>
</div>
</div>
</div>
</details>
<div class="paragraph">
<p>For more context, you can read the
<a href="https://github.com/jtroo/kanata/issues/80">issue that sparked the creation of virtual keys</a>.</p>
</div>
<div class="paragraph">
<p>Something notable about virtual keys is that they don&#8217;t always interrupt the state
of an active <code>tap-dance-eager</code>. If a <code>macro</code> action is assigned to a virtual
key, this won&#8217;t interrupt a tap dance. However, most other action types,
notably a "normal" key action like <code>rsft</code> will still interrupt a tap dance.</p>
</div>
</div>
<div class="sect2">
<h3 id="sequences">Sequences</h3>
<div class="paragraph">
<p>The <code>sldr</code> action makes kanata go into "sequence" mode. The action name is
short for "sequence leader". This comes from Vim which has the concept of a configurable
sequence leader key. When in sequence mode, keys are not typed
(<a href="#sequence-input-mode">by default</a>)
but are saved until one of the following happens:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A key is typed that does not match any sequence</p>
</li>
<li>
<p><code>sequence-timeout</code> milliseconds elapses since the most recent key press</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Sequences are configured similarly to <code>defvirtualkeys</code>. The first parameter of a
pair must be a defined virtual key name. The second parameter is a list of keys
that will activate a virtual key tap when typed in the defined order. More
precisely, the action triggered is:</p>
</div>
<div class="paragraph">
<p><code>(on-press tap-vkey &lt;virtual key name&gt;)</code></p>
</div>
<div class="listingblock">
<div class="title">Example:</div>
<div class="content">
<pre class="highlight"><code>(defseq git-status (g s t))
(defvirtualkeys git-status (macro g i t spc s t a t u s))
(defalias rcl (tap-hold-release 200 200 sldr rctl))

(defseq
    dotcom (. S-3)
    dotorg (. S-4)

    ;;     The shifted letters in parentheses means a single press of lsft
    ;;     must remain held while both h and then s are pressed.
    ;;     This is not the same as S-h S-s, which means that the lsft key
    ;;     must be released and repressed between the h and s presses.
    https (S-(h s))
)
(defvirtualkeys
    dotcom (macro . c o m)
    dotorg (macro . o r g)
    https (macro h t t p s S-; / /)
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>There are 10 special keys with names <code>nop0-nop9</code> which kanata treats specially.
Kanata will never send OS events for these keys
but they can still participate in sequences.</p>
</div>
<div class="paragraph">
<p>See an example of using the nop keys
alongside templates to define sequences below.</p>
</div>
<div class="listingblock">
<div class="title">Example:</div>
<div class="content">
<pre class="highlight"><code>(defsrc f7   f8   f9   f10)
(deflayer base
        sldr nop0 nop1 nop2)
(deftemplate seq (vk-name input-keys output-action)
        sldr(defvirtualkeys $vk-name $output-action)
        sldr(defseq $vk-name $input-keys)
)
;; template-expand has a shortened form: t!
(t! seq dotcom (nop0 nop1) (macro . c o m))
(t! seq dotorg (nop0 nop2) (macro . o r g))</code></pre>
</div>
</div>
<div class="paragraph">
<p>If 10 special nop keys do not seem sufficient,
you can get creative with your sequences and treat some as a prefix modifier.
For example, you can get 24 "keys" by treating <code>nop0-nop5</code> as normal
while treating <code>nop6-nop9</code> as prefixes that are always followed by a second nop key.</p>
</div>
<div class="listingblock">
<div class="title">Example:</div>
<div class="content">
<pre class="highlight"><code>(defalias
  nop0 nop0
  ;; ...
  nop5 nop5
  nop6 (macro nop6 nop0)
  ;; ...
  nop11 (macro nop6 nop5)
  ;; ...
  nop18 (macro nop9 nop0)
  ;; ...
  nop23 (macro nop9 nop5)
)</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_overlapping_keys_in_any_order">Overlapping keys in any order</h4>
<div class="paragraph">
<p>Within the key list of <code>defseq</code> configuration items,
the special <code>O-</code> list prefix can be used to denote a set of keys that must
all be pressed before any are released in order to match the sequence.</p>
</div>
<div class="paragraph">
<p>For an example, <code>O-(a b c)</code> is equivalent to <code>O-(c b a)</code>.</p>
</div>
<div class="listingblock">
<div class="title">Example:</div>
<div class="content">
<pre class="highlight"><code>(defvirtualkey hello (macro h (unshift e l) 5 (unshift l o)))
(defseq hello (O-(h l o)))</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
The way that sequences implements this functionality behind the scenes
is by generating a sequence for every permutation of the overlapping keys.
This can make kanata use up a lot of memory.
Due to this, the maximum keys allowed in a given <code>O-(&#8230;&#8203;)</code> list is 6,
but you are still permitted to add more to the sequence,
including more <code>O-(&#8230;&#8203;)</code> lists.
Doing the above can balloon kanata&#8217;s memory consumption.
</td>
</tr>
</table>
</div>
<details>
<summary class="title">Sample of more advanced usage</summary>
<div class="content">
<div class="paragraph">
<p>The configuration below showcases context-dependent chording
with auto-space and auto-deleted spaces from typing punctuation.</p>
</div>
<div class="paragraph">
<p>For example, chording <code>(d a y)</code> and then <code>(t u e)</code> will output
<code>Tuesday</code>, while chording <code>(t u e)</code> by itself does nothing.</p>
</div>
<div class="listingblock">
<div class="title">Example configuration:</div>
<div class="content">
<pre class="highlight"><code>(defsrc f1)
(deflayer base lrld)
(defcfg process-unmapped-keys yes
	sequence-input-mode visible-backspaced
	concurrent-tap-hold true)
(deftemplate seq (vk-name in out)
	(defvirtualkeys $vk-name $out)
	(defseq $vk-name $in))

(defvirtualkeys rls-sft (multi (release-key lsft)(release-key rsft)))
(defvar rls-sft (on-press tap-vkey rls-sft))
(deftemplate rls-sft () $rls-sft 5)

(defchordsv2
	(d a y) (macro sldr d (t! rls-sft) a y spc nop0) 200 first-release ()
	(h l o) (macro h (t! rls-sft) e l l o sldr spc nop0) 200 first-release ()
)
(t! seq Monday (d a y spc nop0 O-(m o n)) (macro S-m $rls-sft o n d a y nop9 sldr spc nop0))
(t! seq Tuesday (d a y spc nop0 O-(t u e)) (macro S-t $rls-sft u e s d a y nop9 sldr spc nop0))
(t! seq DelSpace_. (spc nop0 .) (macro .))
(t! seq DelSpace_; (spc nop0 ;) (macro ;))</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Try using the above configuration to type the text:</div>
<div class="content">
<pre class="highlight"><code>day;
Day;
Tuesday.
day hello
hello day
Hello day.
hello Tuesday
Hello Monday;</code></pre>
</div>
</div>
</div>
</details>
</div>
<div class="sect3">
<h4 id="_override_the_global_timeout_and_input_mode">Override the global timeout and input mode</h4>
<div class="paragraph">
<p>An alternative to using <code>sldr</code> is the <code>sequence</code> action.
The syntax is <code>(sequence &lt;timeout&gt;)</code>.
This enters sequence mode with a sequence timeout
different from the globally configured one.</p>
</div>
<div class="paragraph">
<p>The <code>sequence</code> action can also be called with a second parameter.
The second parameter is an override for <code>sequence-input-mode</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>(sequence &lt;timeout&gt; &lt;input-mode&gt;)</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example:</div>
<div class="content">
<pre class="highlight"><code>;; Enter sequence mode and input . with a timeout of 250
(defalias dot-sequence (macro (sequence 250) 10 .))

;; Enter sequence mode and input . with a timeout of 250 and using hidden-delay-type
(defalias dot-sequence (macro (sequence 250 hidden-delay-type) 10 .))</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_more_about_sequences">More about sequences</h4>
<div class="paragraph">
<p>For more context about sequences, you can read the
<a href="https://github.com/jtroo/kanata/issues/97">design and motivation of sequences</a>.
You may also be interested in
<a href="https://github.com/jtroo/kanata/blob/main/docs/sequence-adding-chords-ideas.md">the document describing chords in sequences</a>
to read about how chords in sequences behave.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="input-chords">Input chords</h3>
<div class="paragraph">
<p>Not to be confused with <a href="#output-chords-combos">output chords</a>, <code>chord</code>
actions allow you to perform various actions based on which specific combination
of input keys are pressed together. Such an unordered combination of keys
is called a "chord". Each chord can perform a different action, allowing you
to bind up to <code>2^n - 1</code> different actions to just <code>n</code> keys.</p>
</div>
<div class="paragraph">
<p>Input chords are configured similarly to <code>defalias</code> with two extra parameters
at the beginning of each <code>defchords</code> group: the name of the group and a
timeout value after which a chord triggers if it isn&#8217;t triggered by a key release
or press of a non-chord key before the timeout expires.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>(defsrc a b c)
(deflayer default
  @cha @chb @chc
)

(defalias
  cha (chord example a)
  chb (chord example b)
  chc (chord example c)
)

(defchords example 500
  (a      ) a
  (   b   ) b
  (a     c) C-v
  (a  b  c) @three
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The first item of each pair specifies the keys that make up a given chord.
The second item of each pair is the action to be executed when the given chord
is pressed and may be any regular or advanced action, including aliases. It
currently cannot however contain another <code>chord</code> action.</p>
</div>
<div class="paragraph">
<p>Note that unlike with <code>defseq</code>, these keys do not directly correspond to real
keys and are merely arbitrary labels that make sense within the context of the
chord.
They are mapped to real keys in layers by configuring the key in the layer to
map to a <code>(chord name key)</code> action where <code>name</code> is the name of the chords
group (above <code>example</code>) and <code>key</code> is one of these arbitrary labels.</p>
</div>
<div class="paragraph">
<p>It is perfectly valid to nest these <code>chord</code> actions that enter "chording mode"
within other actions like <code>tap-dance</code> and that will work as one would expect.
However, this only applies to the first key used to enter "chording mode".
Once "chording mode" is active, all other keys will be directly handled by
"chording mode" with no regard for wrapper actions; e.g. if a key is pressed
and it maps to a tap-hold with a chord as the hold action within, that chord
key will immediately activate instead of the key needing to be held for the
timeout period.</p>
</div>
<div class="paragraph">
<p><strong>Release behaviour</strong></p>
</div>
<div class="paragraph">
<p>For single key actions and output chords â€” like <code>lctl</code> or <code>S-tab</code> â€”
and for <code>layer-while-held</code>,
an input chord will release the action only when all keys that are part of
the input chord have been released.
In other words, if even one key is held for the input chord
then the output action will be continued to be held,
but only for the mentioned action categories.
The behaviour also applies to the actions mentioned above
when used inside of <code>multi</code> but not within any other action.</p>
</div>
<div class="paragraph">
<p>An exception to the behaviour described above
for the action categories that would normally apply
is if a chord decomposition occurs.
A chord decomposition occurs when you input a chord
that does not correspond to any action.
When this happens, kanata splits up the key presses to activate
other actions from the components of the input chord.
In this scenario, the behaviour described in the next paragraph will occur.</p>
</div>
<div class="paragraph">
<p>For chord decompositions and all other action categories,
the release behaviour is more confusing:
the output action will end when any key is released during the timeout,
or if the timeout expires, the output action ends when the <strong>first</strong> key
that was pressed in the chord gets released.
This inconsistency is a limitation of the current implementation.
In these scenarios it is recommended
to hold down all keys if you want to keep holding
and to release all keys if you want to do a release.
This is because it will probably be difficult
to know which key was pressed first.</p>
</div>
<div class="paragraph">
<p>If you want to bypass the behaviour of keys being held for chord outputs,
you could change the chord output actions to be <a href="#macro">macros</a> instead.
Using a macro will guarantee a rapid press+release for the output keys.</p>
</div>
</div>
<div class="sect2">
<h3 id="defaliasenvcond">defaliasenvcond</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
this configuration item is older and instead you may want to use
the newer and more generalized <a href="#environment">Environment-conditional configuration</a> configuration.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>There is a variant of <code>defalias</code>: <code>defaliasenvcond</code>.
This variant is parsed similarly,
but there must be an extra list parameter
that comes before all of the name-action pairs.</p>
</div>
<div class="paragraph">
<p>The list must contain two strings.
In order, these strings are:
an environment variable name,
and the environment variable value.
When the environment variable defined by the name
has the corresponding value when starting kanata,
the aliases within will be active.
Otherwise, the aliases will be skipped.</p>
</div>
<div class="paragraph">
<p>A use case for <code>defaliasenvcond</code> is when one has multiple devices
which vary in layout of keys,
e.g. different special keys on the bottom row.
Using environment variables, one can use the same kanata
configuration across those multiple devices
while changing key behaviours to keep consistent behaviour
of specific key positions across the multiple devices,
when the hardware keys at those physical key positions are not
the same.</p>
</div>
<div class="listingblock">
<div class="title">Example:</div>
<div class="content">
<pre class="highlight"><code>(defaliasenvcond (LAPTOP lp1)
  met @lp1met
)

(defaliasenvcond (LAPTOP lp2)
  met @lp2met
)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Set environment variables in the current terminal process:</div>
<div class="content">
<pre class="highlight"><code># powershell
$env:VAR_NAME = "var_value"

# bash
VAR_NAME=var_value</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="templates">Templates</h3>
<div class="paragraph">
<p>The top-level configuration item <code>deftemplate</code>
declares a template that can be expanded multiple times
via the list item <code>template-expand</code>.
The short form of <code>template-expand</code> is <code>t!</code>.</p>
</div>
<div class="paragraph">
<p>The parameters to <code>deftemplate</code> in order are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Template name</p>
</li>
<li>
<p>List of template variables</p>
</li>
<li>
<p>Template content (any combination of lists / strings)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Within the template content, variable names prefixed with <code>$</code>
will be substituted with the expression passed into <code>template-expand</code>.</p>
</div>
<div class="paragraph">
<p>The list item <code>template-expand</code> can be placed as a top-level list
or within another list.
Its parameters in order are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>template name</p>
</li>
<li>
<p>parameters to substitute into the template</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Template expansion happens after file includes and before any other parsing.
One consequence of this early parsing is that variables defined in <code>defvar</code>
are <strong>not</strong> substituted when used inside of <code>template-expand</code>.
This has consequences for condtional content, e.g. with <code>if-equal</code>.
This is discussed further in Example 5.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Example 1:</p>
</div>
<div class="paragraph">
<p>In a simple example, let&#8217;s say you wanted to set a large group of keys
to do something different when you&#8217;re holding alt. Yes, this could also
be handled with remapping alt to a layer shift, but there are cases where
you wouldn&#8217;t want this. Rather than retyping the code with <code>fork</code> and
<code>unmod</code> (to release alt) a bunch of times, you could template it like so:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>(deftemplate alt-fork (original-action new-action)
  (fork $original-action (multi (unmod (ralt lalt) nop0) $new-action) (lalt ralt))
)
(defsrc 1 2 3)
(defalias fn1 (template-expand alt-fork 1 f1))
;; Templates are a simple text substitution, so the above is exactly equivalent to:
;; (defalias fn1 (fork 1 (multi (unmod (ralt lalt) nop0) f1) (lalt ralt)))
(defalias fn2 (template-expand alt-fork 2 f2))
;; You can use t! as a short form of template-expand
(defalias fn3 (t! alt-fork 3 f3))
(deflayer default @fn1 @fn2 @fn3)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example 2:</div>
<div class="content">
<pre class="highlight"><code>(defvar chord-timeout 200)
(defcfg process-unmapped-keys yes)

;; This template defines a chord group and aliases that use the chord group.
;; The purpose is to easily define the same chord position behaviour
;; for multiple layers that have different underlying keys.
(deftemplate left-hand-chords (chordgroupname k1 k2 k3 k4 alias1 alias2 alias3 alias4)
  (defalias
    $alias1 (chord $chordgroupname $k1)
    $alias2 (chord $chordgroupname $k2)
    $alias3 (chord $chordgroupname $k3)
    $alias4 (chord $chordgroupname $k4)
  )
  (defchords $chordgroupname $chord-timeout
    ($k1) $k1
    ($k2) $k2
    ($k3) $k3
    ($k4) $k4
    ($k1 $k2) lctl
    ($k3 $k4) lsft
  )
)

(template-expand left-hand-chords qwerty a s d f qwa qws qwd qwf)
;; t! is short for template-expand
(t! left-hand-chords dvorak a o e u dva dvo dve dvu)

(defsrc a s d f)
(deflayer dvorak @dva @dvo @dve @dvu)
(deflayer qwerty @qwa @qws @qwd @qwf)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example 3:</div>
<div class="content">
<pre class="highlight"><code>;; This template defines a home row that customizes a single key's behaviour
(deftemplate home-row (j-behaviour)
  a s d f g h $j-behaviour k l ; '
)

(defsrc
  grv  1    2    3    4    5    6    7    8    9    0    -    =    bspc
  tab  q    w    e    r    t    y    u    i    o    p    [    ]    \
       ;; usable even inside defsrc
  caps (t! home-row j)                            ret
  lsft z    x    c    v    b    n    m    ,    .    /    rsft
  lctl lmet lalt           spc            ralt rmet rctl
)

(deflayer base
  grv  1    2    3    4    5    6    7    8    9    0    -    =    bspc
  tab  q    w    e    r    t    y    u    i    o    p    [    ]    \
                                 ;; lists can be passed in too!
  caps (t! home-row (tap-hold 200 200 j lctl))    ret
  lsft z    x    c    v    b    n    m    ,    .    /    rsft
  lctl lmet lalt           spc            ralt rmet rctl
)</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_if_equal">if-equal</h4>
<div class="paragraph">
<p>Within a template you can use the list item <code>if-equal</code>
to have condiditionally-used items within a template.</p>
</div>
<div class="paragraph">
<p>It accepts a minimum of 2 parameters.
The first two parameters must be strings and are compared
against each other.
If they match, the following parameters are inserted into
the template in place of the <code>if-equal</code> list.
Otherwise if the strings do not match
then the whole <code>if-equal</code> list is removed from the template.</p>
</div>
<div class="listingblock">
<div class="title">Example 4:</div>
<div class="content">
<pre>(deftemplate home-row (version)
  a s d f g h
  (if-equal $version v1 j)
  (if-equal $version v2 (tap-hold 200 200 j lctl))
   k l ; '
)

(defsrc
  grv  1    2    3    4    5    6    7    8    9    0    -    =    bspc
  tab  q    w    e    r    t    y    u    i    o    p    [    ]    \
  caps (template-expand home-row v1)                            ret
  lsft z    x    c    v    b    n    m    ,    .    /    rsft
  lctl lmet lalt           spc            ralt rmet rctl
)

(deflayer base
  grv  1    2    3    4    5    6    7    8    9    0    -    =    bspc
  tab  q    w    e    r    t    y    u    i    o    p    [    ]    \
  caps (template-expand home-row v2)                            ret
  lsft z    x    c    v    b    n    m    ,    .    /    rsft
  lctl lmet lalt           spc            ralt rmet rctl
)</pre>
</div>
</div>
<div class="paragraph">
<p>Similar to <code>if-equal</code> are three more conditional operators for templates:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>if-not-equal</code></p>
<div class="ulist">
<ul>
<li>
<p>the content is used if the first two string parameters are not equal</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>if-in-list</code></p>
<div class="ulist">
<ul>
<li>
<p>the content is used if the first string parameter exists in
the second list-of-strings parameter</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>if-not-in-list</code></p>
<div class="ulist">
<ul>
<li>
<p>the content is used if the first string parameter does not exist in
the second list-of-strings parameter</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Example 5:</div>
<div class="content">
<pre>;; defvar is parsed AFTER template expansion occurs.
(defvar a hello)

(deftemplate template1 (var1)
  a (if-equal hello $var1 b) c
)

;; Below will expand to: `a c` because the string
;; $a itself is compared against the string hello
;; and they are not equal.
(template-expand template1 $a)

(deftemplate template2 (var1)
  a (if-equal $a $var1 b) c
)

;; Below will expand to: `a b c` because the string
;; $a is compared against the string $a and they are equal.
;; But note that the variable $a is still not substituted
;; with its defvar value of: hello.
(template-expand template2 $a)</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="concat-in-deftemplate">concat in deftemplate</h4>
<div class="paragraph">
<p>Like <a href="#concat-in-defvar">concat in defvar</a>,
a list beginning with <code>concat</code> within the content of <code>deftemplate</code>
will be replaced with a single string that consists of
all the subsequent items in the list concatenated to each other.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="custom-tap-hold-behaviour">Custom tap-hold behaviour</h3>
<div class="paragraph">
<p>This is not currently configurable without modifying the source code, but if
you&#8217;re willing and/or capable, there is a tap-hold behaviour that is currently
not exposed. Using this behaviour, one can be very particular about when and how
tap vs. hold will activate by using extra information. The available
information that can be used is exactly which keys have been pressed or
released as well as the timing in milliseconds of those key presses.
The action <code>tap-hold-release-keys</code> makes use of some of this capability, but
doesn&#8217;t make full use of the power of this functionality.</p>
</div>
<div class="paragraph">
<p>For more context, you can read the
<a href="https://github.com/jtroo/kanata/issues/128">motivation for custom tap-hold behaviour</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="fancy-key-symbols">Fancy key symbols</h3>
<div class="paragraph">
<p>Instead of using the same <code>a-z</code> letters for special keys, e.g., <code>lsft</code> for <code>LeftShift</code>
you can use much shorter, yet more visible, key symbols like <code>â€¹â‡§</code>.</p>
</div>
<div class="paragraph">
<p>For more details see
<a href="https://github.com/jtroo/kanata/blob/main/docs/fancy_symbols.md">symbol list</a> and
<a href="https://github.com/jtroo/kanata/blob/main/cfg_samples/fancy_symbols.kbd">example config</a>, which not only uses these symbols in layer definitions, but also repurposes <code>âŽ‡â€º</code> and <code>â‡§â€º</code> <code>âŽ‡â€º</code> keys into "symbol" keys that allow you to insert these fancy symbols by pressing the key, e.g.,</p>
</div>
<div class="ulist">
<ul>
<li>
<p>hold <code>âŽ‡â€º</code> and tap <code>Delete</code> would insert <code>â¡</code></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="windows-only-work-elevated">Windows only: enable in elevated windows</h3>
<div class="paragraph">
<p>The default <code>kanata.exe</code> binary doesn&#8217;t work in elevated windows (run with administrative privileges),
e.g., <code>Control Panel</code>. However, you can use AutoHotkey&#8217;s "EnableUIAccess" script to self-sign the binary,
move it to "Program Files", then launching kanata from there will also work in these elevated windows.
See <a href="https://github.com/jtroo/kanata/blob/main/EnableUIAccess">EnableUIAccess</a> folder with the script
and its required libraries (needs <a href="https://www.autohotkey.com/download/">AutoHotkey v2</a> installed)</p>
</div>
<div class="paragraph">
<p>If compiling yourself, you should add the feature flag <code>win_manifest</code>
to enable the use of the <code>EnableUIAccess</code> script:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>cargo build --win_manifest</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="windows-only-win-tray">Windows only: win-tray</h3>
<div class="paragraph">
<p>Kanata can be compiled as a Windows GUI tray app with the feature flag <code>gui</code>.
This can simplify launching the app on user login by placing a <code>.lnk</code>
at <code>%APPDATA%\Microsoft\Windows\Start Menu\Programs\Startup</code>, show custom icon indicator per config</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="https://github.com/jtroo/kanata/blob/main/docs/win-tray/win-tray-screen.png" alt="icon indicator per config" width="477" height="129"></span></p>
</div>
<div class="paragraph">
<p>as well as dynamic icon indicator per layer (might need to click on the gif below to play)</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="https://github.com/jtroo/kanata/blob/main/docs/win-tray/win-tray-layer-change.gif" alt="icon indicator per layer" width="33" height="35"></span></p>
</div>
<div class="paragraph">
<p>(see <a href="#windows-only-win-tray">Windows only: win-tray</a>). It also supports (re)loading configs.</p>
</div>
<div class="paragraph">
<p>Currently the only configuration supported is tray icon per profile, all other configuration should
be done by passing cli flags in the <code>Target</code> field of <code>.lnk</code>, e.g., <code>"C:\Program Files\kanata\kanata.exe" -d -n</code>
to launch kanata without a delay in a debug mode</p>
</div>
<div class="paragraph">
<p>When launched from a command line, the app outputs log to the console, but otherwise the logs are currently
only available via an app capable of viewing <code>OutputDebugString</code> debugs, e.g., <a href="https://github.com/smourier/TraceSpy">TraceSpy</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="test-your-config">Test your config</h3>
<div class="paragraph">
<p>Kanata has a <code>kanata_simulated_input</code> tool
to help test your configuration in a predictable manner.</p>
</div>
<div class="paragraph">
<p>You can try it out on <a href="https://jtroo.github.io/">GitHub pages</a>.</p>
</div>
<div class="paragraph">
<p>Code for the CLI tool can be found under <a href="https://github.com/jtroo/kanata/blob/main/simulated_input/">simulated_input</a>.</p>
</div>
<div class="paragraph">
<p>Instead of physically typing to test something
and wondering whether you didn&#8217;t get the expected result because your config is wrong or
because you mistyped something,
you can write a sequence of key presses in a <code>sim.txt</code> file,
run the tool with your config
and get a "timeline" view of input/output events that can help understand how kanata translates
your input into various key/mouse presses.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
The format of this view may change. Emoji output may break vertical alignment.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For more details download the files below and run <code>kanata_simulated_input -c sim.kbd -s sim.txt</code><br>
  - <a href="https://github.com/jtroo/kanata/blob/main/docs/simulated_output/sim.kbd">example config</a> with simple home row mod bindings<br>
  - <a href="https://github.com/jtroo/kanata/blob/main/docs/simulated_output/sim.txt">example input sequence</a><br>
  - <a href="https://github.com/jtroo/kanata/blob/main/docs/simulated_output/sim_out.txt">example output sequence</a><br></p>
</div>
<div class="paragraph">
<p>Input sequence file format: whitespace insensitive list of <code>prefix:key</code> pairs where prefix is one of:<br>
  - <code>ðŸ•</code>, <code>t</code>, or <code>tick</code> to add time between key events in <code>ms</code><br>
  - <code>â†“</code>, <code>d</code>, <code>down</code>, or <code>press</code><br>
  - <code>â†‘</code>, <code>u</code>, <code>up</code>, or <code>release</code><br>
  - <code>âŸ³</code>, <code>r</code>, or <code>repeat</code><br></p>
</div>
<div class="paragraph">
<p>And key names are defined in the <a href="https://github.com/jtroo/kanata/blob/main/parser/src/keys/mod.rs">str_to_oscode function</a>,
for example, <code>1</code> for the numeric key 1 or <code>kp1</code>/<code>ðŸ”¢â‚</code> for the keypad numeric key 1</p>
</div>
<div class="paragraph">
<p>Using unicode symbols <code>ðŸ•</code>,<code>â†“</code>,<code>â†‘</code>,<code>âŸ³</code> allows skipping the <code>:</code> separator, e.g., <code>â†“k</code> â‰ <code>â†“:k</code> â‰ <code>d:k</code></p>
</div>
</div>
<div class="sect2">
<h3 id="zippychord">Zippychord</h3>
<div class="paragraph">
<p><strong>Reference</strong></p>
</div>
<div class="paragraph">
<p>You may define a single <code>defzippy-experimental</code> configuration item.
As suggested by the -experimental label, this feature is relatively recent.
When using this you are at higher likelihood of bugs and breaking changes.</p>
</div>
<div class="listingblock">
<div class="title">Configuration syntax within the kanata configuration</div>
<div class="content">
<pre class="highlight"><code>(defzippy-experimental
  $zippy-filename ;; required
  on-first-press-chord-deadline $deadline-millis  ;; optional
  idle-reactivate-time          $idle-time-millis ;; optional
  smart-space                   $smart-space-cfg  ;; optional
  smart-space-punctuation (                       ;; optional
    $punc1 $punc2 ... $puncN)
  output-character-mappings (    ;; optional
    $character1 $output-mapping1
    $character2 $output-mapping2
    ;; ...
    $characterN $output-mappingN
  )
)</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$zippy-filename</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Relative or absolute file path.
If relative, its path is relative to
the directory containing the kanata configuration file.
This must be the first item following <code>defzippy-experimental</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$deadline-millis</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of milliseconds.
After the first press while zippy is enabled,
if no chord activates within this configured time,
zippy is temporarily disabled.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$idle-time-millis</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of milliseconds.
After typing ends and this configured number of milliseconds elapses,
zippy will be re-enabled from being temporarily disabled.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$smart-space-cfg</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Determines the smart space behaviour.
The options are <code>none</code>, <code>add-space-only</code>, and <code>full</code>.
With <code>none</code>, outputs are typed as-is.
With <code>add-space-only</code>, spaces are automatically added after outputs
which end with neither a space or a backspace âŒ«.
With <code>full</code>, the <code>add-space-only</code> behaviour applios
alongside additional behaviour:
typing punctuation (default characters: <code>, . ;</code>)
after a zippy activation will delete a prior automatically-added space.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$punc</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A character defined in <code>output-character-mappings</code>
or a known key name, which shall be considered as punctuation.
The <code>smart-space-punctuation</code> configuration
will overwrite the default punctuation list
considered by smart-space;
if you want to include the default characters,
you must include them in this configuration.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$character</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A single unicode codepoint for use
in the output column of the zippy configuration file.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$output-mapping</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Key or output chord to tell kanata how to type <code>$character</code>
when seen in the zippy file output column.
Must be a single key or output chord.
The output chord may contain <code>AG-</code> to tell kanata to press with AltGr
and may contain <code>S-</code> to tell kanata to press with Shift.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Regarding output mappings,
you can configure the output of the special-lisp-syntax characters
<code>) ( "</code> via these lines:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>    ")"    $right-paren-output
    "("    $left-paren-output
    r#"""# $double-quote-output</code></pre>
</div>
</div>
<div class="paragraph">
<p>As an example, for the US layout these should be the correct lines:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>    ")"     S-0
    "("     S-9
    r#"""#  S-'</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Configuration syntax within the zippy configuration file</div>
<div class="content">
<pre class="highlight"><code>// This is a comment.
//          inputs            â†¹  outputs
$chord1 $follow-chord1.1...1.M	$output1
$chord2 $follow-chord2.1...2.M	$output2
// ...
$chordN $follow-chordN.1...N.M	$outputN</code></pre>
</div>
</div>
<div class="paragraph">
<p>The format is two columns separated by a single Tab character.
The first column is input and the second is output.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$chord</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A set of characters.
You can use space by including it as the first character in the chord;
for an example see <code>Alphabet</code> in the sample below.
With 0 optional follow chords,
the corresponding output on the same line (<code>$output</code>)
will activate when zippy is enabled
and all the defined chord keys are pressed simultaneously.
The order of presses is not important.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$chord-follow</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0 or more chords, used the same way as <code>$chord</code>.
Having follow chords means the <code>$output</code> on the same line
will activate upon first activating the earlier chord(s) in the same line,
releasing all keys, and pressing the keys in <code>$chord-followN.M</code>.
Follow chords are separated from the previous chord by a space.
If using a space in the follow chord, use two spaces;
for an example see <code>Washington</code> in the sample below.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$output</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The characters to type when the chord and optional follow chord(s)
are all pressed by the user.
This is separated from the input chord column
by a single Tab character.
The characters are typed in sequence
and must all be singular-name key names
as one would configure in <code>defsrc</code>.
As an exception, capitalized single-character key names
will be parsed successfully
and these will be outputted alongside Shift to output the capitalized key.
Additionally, <code>output-character-mappings</code> configuration can be used
to inform kanata of additional mappings that may use Shift or AltGr.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Examples</strong></p>
</div>
<div class="listingblock">
<div class="title">Sample kanata configuration</div>
<div class="content">
<pre class="highlight"><code>(defzippy-experimental
  zippy.txt
  on-first-press-chord-deadline 500
  idle-reactivate-time          500
  smart-space-punctuation (? ! . , ; :)
  output-character-mappings (
    ;; This should work for US international.
    ! S-1
    ? S-/
    % S-5
    "(" S-9
    ")" S-0
    : S-;
    &lt; S-,
    &gt; S-.
    r#"""# S-'
    | S-\
    _ S--
    Â® AG-r
  )
)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Sample zippy file content</div>
<div class="content">
<pre class="highlight"><code>dy	day
dy 1	Monday
dy 2	Tuesday
 abc	alphabet
 w  a	Washington
gi	git
gi f p	git fetch -p</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Description</strong></p>
</div>
<div class="paragraph">
<p>Zippychord is yet another chording mechanism in Kanata.
The inspiration behind it is primarily the
<a href="https://github.com/psoukie/zipchord">zipchord project</a>.
The name is similar; it is named "zippy" instead of "zip" because
Kanata&#8217;s implementation is not a port and does not aim for 100%
behavioural compatibility.</p>
</div>
<div class="paragraph">
<p>The intended use case is shorthands, or accelerating character output.
Within zippychord, inputs are keycode chords or sequences,
and the outputs are also purely keycodes.
In other words, all other actions are unsupported;
e.g. layers, switch, one-shot.</p>
</div>
<div class="paragraph">
<p>Zippychord behaves on outputted keycodes, i.e. the key outputs
after kanata has finished processing your
inputs, layers, switch logic and other configurations.
This is similar to how sequences operate
and is unlike chords(v1) and chordsv2.
Furthermore, outputs are all eager like <code>visible-backspaced</code> on sequences.
If a zippchord activation occurs, typed keys are backspaced.</p>
</div>
<div class="paragraph">
<p>To give an example, if one configures zippychord with a line like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>gi	git</code></pre>
</div>
</div>
<div class="paragraph">
<p>then either of the following typing event sequences
will erase the input characters
and then proceed to type the output "git"
like if it was <code>(macro bspc bspc g i t)</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>(press g) (press i)
(press i) (press g)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that there aren&#8217;t any release events listed.
To contrast, the following event sequence would not result in an activation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>(press g) (release g) (press i)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Zippychord supports fully overlapping chords and sequences.
For example, this configuration is allowed:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>gi	gitâ£
gi s	gitâ£status
gi c	git checkoutâ£
gi c b	git checkout -bâ£
gi c a	git commit --amendâ£
gi c n	git commit --amend --no-edit
gi c a m	git commit --amend -m 'FIX_THIS_COMMIT_MESSAGE'</code></pre>
</div>
</div>
<div class="paragraph">
<p>When you begin with the <code>(g i)</code> chord, you can follow up
with various character sequences to output different git commands.
This use case is quite similar to git aliases.
One advantage of zippychord is that it eagerly shows you
the true underlying command as you type.</p>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2024-11-20 23:48:15 -0800
</div>
</div>
</body>
</html>